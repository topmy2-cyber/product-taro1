<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5H5GVL4BH2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5H5GVL4BH2');
</script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>꿈타로 - AI 타로 운세 및 사주 분석 | 당신의 운명을 비춰보는 신비로운 거울</title>

<!-- SEO 및 메타 데이터 최적화 (Google & Naver 가이드라인 적용) -->
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
<link rel="canonical" href="https://product-taro1.pages.dev/">
<link rel="alternate" hreflang="ko" href="https://product-taro1.pages.dev/">
<link rel="alternate" hreflang="en" href="https://product-taro1.pages.dev/">
<link rel="alternate" hreflang="x-default" href="https://product-taro1.pages.dev/">

<!-- 지리적 최적화 (GEO Tags) -->
<meta name="geo.region" content="KR">
<meta name="geo.placename" content="Seoul">
<meta name="geo.position" content="37.5665;126.9780">
<meta name="ICBM" content="37.5665, 126.9780">

<meta name="description" content="신비로운 AI 꿈타로에서 무료 타로 운세, 연애운, 올해의 운세, 직업운을 확인하세요. 정교한 타로 알고리즘과 사주 명리학 기운 분석이 결합된 고품질 리딩을 제공합니다.">
<meta name="keywords" content="타로, 타로운세, 무료타로, 오늘운세, 궁합, 직업운, 연애운, 꿈타로, AI타로, 사주타로, 신년운세, 2026운세">

<!-- Open Graph (소셜 미디어 및 네이버 최적화) -->
<meta property="og:site_name" content="꿈타로 (DreamTarot)">
<meta property="og:title" content="꿈타로 - AI 타로 운세 및 사주 분석">
<meta property="og:description" content="별의 궤적이 그리는 당신의 운명, 정교한 AI 타로와 사주 기운의 교차 분석으로 지금 확인해보세요.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://product-taro1.pages.dev/">
<meta property="og:image" content="https://product-taro1.pages.dev/card-back.png?v=2">
<meta property="og:locale" content="ko_KR">
<meta property="og:locale:alternate" content="en_US">

<!-- Twitter Card (트위터 최적화) -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="꿈타로 - AI 타로 운세 및 사주 분석">
<meta name="twitter:description" content="별의 궤적이 그리는 당신의 운명, 정교한 AI 타로와 사주 기운의 교차 분석으로 지금 확인해보세요.">
<meta name="twitter:image" content="https://product-taro1.pages.dev/card-back.png?v=2">

<!-- 구조화된 데이터 (JSON-LD) 보강: GEO 및 AI 최적화 -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "꿈타로 (DreamTarot)",
  "url": "https://product-taro1.pages.dev/",
  "description": "AI 기반 타로 운세 및 사주 분석 서비스",
  "applicationCategory": "EntertainmentApplication",
  "operatingSystem": "All",
  "inLanguage": ["ko", "en"],
  "contentLocation": {
    "@type": "Place",
    "name": "South Korea"
  },
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "KRW"
  },
  "author": {
    "@type": "Organization",
    "name": "DreamTarot Team",
    "areaServed": "Global"
  }
}
</script>

<!-- Google AdSense -->
<meta name="google-adsense-account" content="ca-pub-5883207825809699">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5883207825809699"
crossorigin="anonymous"></script>

<!-- 렌더링 차단 리소스 최적화: 스크립트 defer 적용 -->
<script src="https://cdn.tailwindcss.com" defer></script>
<script src="https://unpkg.com/lucide@latest" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
<script src="main.js" defer></script>

<style>
/* 기초 스타일 및 배경 */
body {
font-family: 'Pretendard', system-ui, sans-serif;
background-color: #020617;
background-image: radial-gradient(at 0% 0%, rgba(59, 7, 100, 0.4) 0px, transparent 50%), radial-gradient(at 50% 0%, rgba(15, 23, 42, 0.8) 0px, transparent 50%), radial-gradient(at 100% 0%, rgba(88, 28, 135, 0.3) 0px, transparent 50%);
background-attachment: fixed;
color: #f1f5f9;
min-height: 100vh;
margin: 0;
overflow-x: hidden;
}

/* 애니메이션 효과 */
.stars-container { position: fixed; inset: 0; pointer-events: none; z-index: 0; }
.star { position: absolute; background: white; border-radius: 50%; opacity: 0.5; animation: twinkle var(--duration) infinite ease-in-out; }
@keyframes twinkle { 0%, 100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 1; transform: scale(1.2); } }

.fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
.fade-in-centered { animation: fadeInCentered 0.5s ease-in-out forwards; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeInCentered { from { opacity: 0; transform: translate(-50%, calc(-50% + 10px)); } to { opacity: 1; transform: translate(-50%, -50%); } }

/* UI 컴포넌트 */
input[type="radio"]:checked + div { background-color: rgba(147, 51, 234, 0.5); border-color: #fbbf24; color: #fef3c7; }
.lang-btn { transition: all 0.2s; opacity: 0.5; cursor: pointer; }
.lang-btn.active { opacity: 1; font-weight: bold; color: #fbbf24; border-bottom: 2px solid #fbbf24; }
.custom-scrollbar::-webkit-scrollbar { width: 6px; }
.custom-scrollbar::-webkit-scrollbar-track { background: rgba(30, 41, 59, 0.5); }
.custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(147, 51, 234, 0.5); border-radius: 10px; }

/* 타로 카드 관련 */
.tarot-card-deck { display: flex; justify-content: center; flex-wrap: wrap; padding: 1rem; max-width: 800px; margin: 0 auto; }
.tarot-card-item { width: 3.5rem; height: 5.5rem; margin-left: -3.3rem; border-radius: 0.5rem; background: url('card-back.png?v=2') center/cover; box-shadow: 0 4px 6px rgba(0,0,0,0.5); transition: all 0.3s; cursor: pointer; border: 1px solid #fbbf24; }
.tarot-card-item:first-child { margin-left: 0; }
.tarot-card-item:hover { transform: translateY(-1rem); box-shadow: 0 10px 15px rgba(251, 191, 36, 0.5); z-index: 10; }
.tarot-card-item.drawn { opacity: 0; pointer-events: none; transform: translateY(2rem) scale(0.8); }

@media (min-width: 768px) { .tarot-card-item { width: 4.5rem; height: 7rem; margin-left: -4.2rem; } }

.star-spread-container { position: relative; width: 100%; max-width: 500px; aspect-ratio: 1/1; margin: 0 auto; }
.spread-card { position: absolute; transform: translate(-50%, -50%); width: 6rem; height: 9rem; transition: all 0.8s; z-index: 10; }
.card-front { width: 100%; height: 100%; background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.95)); border: 2px solid rgba(251, 191, 36, 0.6); border-radius: 0.75rem; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 0 25px rgba(168, 85, 247, 0.5); color: #fef3c7; padding: 0.5rem; text-align: center; backdrop-filter: blur(8px); }

/* 좌표 클래스 */
.pos-1 { top: 15%; left: 50%; } .pos-2 { top: 40%; left: 85%; } .pos-3 { top: 85%; left: 70%; } .pos-4 { top: 85%; left: 30%; } .pos-5 { top: 40%; left: 15%; }
.pos-today-1 { top: 50%; left: 20%; } .pos-today-2 { top: 50%; left: 50%; } .pos-today-3 { top: 50%; left: 80%; }
</style>
</head>
<body class="selection:bg-purple-500/30">

<!-- 3D 우주 배경 -->
<div class="space-background">
<div class="galaxy-layer"></div>
<div class="stars-container"></div>
</div>

<!-- 장식용 별빛 효과 배경 요소들 -->
<div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
<div class="absolute top-10 left-10 w-32 h-32 bg-purple-600/20 rounded-full blur-3xl"></div>
<div class="absolute bottom-10 right-10 w-64 h-64 bg-amber-600/10 rounded-full blur-3xl"></div>
</div>

<!-- 다국어 언어 전환 토글 버튼 (우측 상단 고정) -->
<div class="absolute top-6 right-6 z-50 flex gap-3 text-sm font-medium text-slate-300">
<button id="lang-ko" onclick="setLanguage('ko')" class="lang-btn pb-1">KR</button>
<span class="text-slate-600">|</span>
<button id="lang-en" onclick="setLanguage('en')" class="lang-btn active pb-1">EN</button>
</div>

<!-- 토스트 메시지 컨테이너 -->
<div id="toast-container" class="fixed top-20 right-4 z-50 flex flex-col gap-2 pointer-events-none"></div>

<!-- 메인 컨텐츠 영역 -->
<div class="relative z-10 w-full">

<!-- ========================================== -->
<!-- 1단계: 개인정보 입력 화면 (profile-screen) -->
<!-- ========================================== -->
<div id="profile-screen" class="flex flex-col items-center justify-start md:justify-center min-h-screen p-4 pt-16 md:pt-4 fade-in">

<div class="text-center mb-8">
<div class="relative flex justify-center items-center mb-8 h-24">
<!-- 몽환적인 배경 오로라 효과 -->
<div class="absolute w-32 h-32 bg-indigo-600/30 rounded-full blur-3xl animate-pulse"></div>
<div class="absolute w-24 h-24 bg-purple-500/20 rounded-full blur-2xl animate-pulse" style="animation-delay: 1s;"></div>

<!-- 입체적인 미래적 보석 로고 (SVG) -->
<div class="relative group scale-110">
<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" class="drop-shadow-[0_0_30px_rgba(168,85,247,0.8)] filter drop-shadow-lg">
<defs>
<!-- 광원 효과용 그라데이션 -->
<linearGradient id="gemLight" x1="0%" y1="0%" x2="100%" y2="100%">
<stop offset="0%" stop-color="#fef3c7" /> <!-- 빛나는 부분 -->
<stop offset="100%" stop-color="#fbbf24" />
</linearGradient>
<linearGradient id="gemMedium" x1="0%" y1="0%" x2="100%" y2="100%">
<stop offset="0%" stop-color="#a855f7" />
<stop offset="100%" stop-color="#7e22ce" />
</linearGradient>
<linearGradient id="gemDark" x1="0%" y1="0%" x2="100%" y2="100%">
<stop offset="0%" stop-color="#6366f1" />
<stop offset="100%" stop-color="#4338ca" />
</linearGradient>
<filter id="innerGlow">
<feGaussianBlur stdDeviation="1.5" result="blur"/>
<feComposite in="SourceGraphic" in2="blur" operator="arithmetic" k2="1" k3="0.5" />
</filter>
<filter id="glow">
<feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>
<feMerge>
<feMergeNode in="coloredBlur"/>
<feMergeNode in="SourceGraphic"/>
</feMerge>
</filter>
</defs>

<!-- 8면체 입체 보석 효과 -->
<g filter="url(#innerGlow)">
<!-- 상단 -->
<path d="M50 5 L35 35 L50 50 Z" fill="url(#gemLight)" opacity="0.9" />
<path d="M50 5 L65 35 L50 50 Z" fill="#fbbf24" opacity="0.7" />
<!-- 우측 -->
<path d="M95 50 L65 35 L50 50 Z" fill="url(#gemMedium)" opacity="0.9" />
<path d="M95 50 L65 65 L50 50 Z" fill="#9333ea" opacity="0.7" />
<!-- 하단 -->
<path d="M50 95 L65 65 L50 50 Z" fill="url(#gemDark)" opacity="0.9" />
<path d="M50 95 L35 65 L50 50 Z" fill="#4f46e5" opacity="0.7" />
<!-- 좌측 -->
<path d="M5 50 L35 65 L50 50 Z" fill="#a855f7" opacity="0.8" />
<path d="M5 50 L35 35 L50 50 Z" fill="#fbbf24" opacity="0.5" />
</g>

<!-- 중앙 코어 -->
<circle cx="50" cy="50" r="4" fill="white" filter="url(#glow)">
<animate attributeName="r" values="3;5;3" dur="2s" repeatCount="indefinite" />
</circle>
</svg>

<!-- 3D 회전 궤도 고리 (Futuristic 3D Rings) -->
<div class="absolute inset-0 flex items-center justify-center pointer-events-none" style="perspective: 500px;">
<div class="w-24 h-24 border-2 border-purple-400/40 rounded-full animate-spin" 
style="animation-duration: 4s; transform: rotateX(70deg) rotateY(10deg);"></div>
</div>
<div class="absolute inset-0 flex items-center justify-center pointer-events-none" style="perspective: 500px;">
<div class="w-20 h-20 border-2 border-amber-400/30 rounded-full animate-spin" 
style="animation-duration: 7s; animation-direction: reverse; transform: rotateX(60deg) rotateY(-20deg);"></div>
</div>
<div class="absolute inset-0 flex items-center justify-center pointer-events-none" style="perspective: 500px;">
<div class="w-28 h-28 border border-indigo-400/20 rounded-full animate-spin" 
style="animation-duration: 10s; transform: rotateX(45deg) rotateY(45deg);"></div>
</div>
</div>
</div>
<h1 class="text-4xl font-bold text-amber-100 mb-2 font-serif tracking-widest" data-i18n="appTitle">꿈타로</h1>
<p class="text-purple-300" data-i18n="appSubtitle">당신의 운명을 비춰보는 신비로운 거울</p>
</div>

<div class="bg-slate-900/80 backdrop-blur-md p-8 rounded-2xl shadow-2xl shadow-purple-900/50 w-full max-w-md border border-purple-500/30">
<form id="profile-form" class="space-y-6">

<div>
<label class="flex items-center text-sm font-medium text-purple-300 mb-2">
<i data-lucide="user" class="w-4 h-4 mr-2"></i> <span data-i18n="labelName">이름</span>
</label>
<input type="text" id="name-input" required class="w-full bg-slate-800 border border-purple-500/50 rounded-lg px-4 py-3 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors" data-i18n="phName" placeholder="홍길동" />
</div>

<div>
<label class="flex items-center text-sm font-medium text-purple-300 mb-2">
<i data-lucide="calendar" class="w-4 h-4 mr-2"></i> <span data-i18n="labelBirth">생년월일</span>
</label>
<div class="flex gap-2 items-center">
<input type="text" id="year-input" required inputmode="numeric" pattern="[0-9]*" maxlength="4" class="w-20 bg-slate-800 border border-purple-500/50 rounded-lg px-2 py-3 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors text-center" placeholder="YYYY" oninput="this.value = this.value.replace(/[^0-9]/g, ''); if(this.value.length === 4) document.getElementById('month-input').focus();" />
<span class="text-purple-500 font-bold">-</span>
<input type="text" id="month-input" required inputmode="numeric" pattern="[0-9]*" maxlength="2" class="w-14 bg-slate-800 border border-purple-500/50 rounded-lg px-2 py-3 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors text-center" placeholder="MM" oninput="this.value = this.value.replace(/[^0-9]/g, ''); if(this.value.length === 2) document.getElementById('day-input').focus();" />
<span class="text-purple-500 font-bold">-</span>
<input type="text" id="day-input" required inputmode="numeric" pattern="[0-9]*" maxlength="2" class="w-14 bg-slate-800 border border-purple-500/50 rounded-lg px-2 py-3 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors text-center" placeholder="DD" oninput="this.value = this.value.replace(/[^0-9]/g, ''); if(this.value.length === 2) document.getElementById('calendar-type-input').focus();" />

<select id="calendar-type-input" class="ml-2 flex-1 bg-slate-800 border border-purple-500/50 rounded-lg px-2 py-3 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors">
<option value="solar" data-i18n="optSolar">양력</option>
<option value="lunar" data-i18n="optLunar">음력</option>
</select>
</div>
</div>

<div>
<label class="block text-sm font-medium text-purple-300 mb-2" data-i18n="labelGender">성별</label>
<div class="grid grid-cols-3 gap-3">
<label class="cursor-pointer">
<input type="radio" name="gender" value="male" class="sr-only peer" />
<div class="text-center bg-slate-800 border border-purple-500/50 rounded-lg py-2 text-sm text-purple-300 transition-all" data-i18n="genMale">남성</div>
</label>
<label class="cursor-pointer">
<input type="radio" name="gender" value="female" class="sr-only peer" />
<div class="text-center bg-slate-800 border border-purple-500/50 rounded-lg py-2 text-sm text-purple-300 transition-all" data-i18n="genFemale">여성</div>
</label>
<label class="cursor-pointer">
<input type="radio" name="gender" value="none" class="sr-only peer" checked />
<div class="text-center bg-slate-800 border border-purple-500/50 rounded-lg py-2 text-sm text-purple-300 transition-all" data-i18n="genNone">선택안함</div>
</label>
</div>
</div>

<div>
<label class="block text-sm font-medium text-purple-300 mb-2" data-i18n="labelMarital">결혼 여부</label>
<div class="grid grid-cols-2 gap-3">
<label class="cursor-pointer">
<input type="radio" name="marital-status" value="single" class="sr-only peer" checked />
<div class="text-center bg-slate-800 border border-purple-500/50 rounded-lg py-2 text-sm text-purple-300 transition-all" data-i18n="marSingle">미혼</div>
</label>
<label class="cursor-pointer">
<input type="radio" name="marital-status" value="married" class="sr-only peer" />
<div class="text-center bg-slate-800 border border-purple-500/50 rounded-lg py-2 text-sm text-purple-300 transition-all" data-i18n="marMarried">기혼</div>
</label>
</div>
</div>

<button type="submit" class="w-full mt-4 bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 text-slate-900 font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-amber-500/50 transition-all flex justify-center items-center">
<span data-i18n="btnSubmitProfile">운명의 수레바퀴 돌리기</span> <i data-lucide="chevron-right" class="ml-2 w-5 h-5"></i>
</button>
</form>
</div>

<!-- AdSense 최적화: 푸터 영역 -->
<footer class="mt-20 py-8 w-full border-t border-purple-500/10 flex flex-col items-center gap-4 text-xs text-slate-500">
<div class="flex flex-wrap justify-center gap-6">
<button onclick="showScreen('about-dreamtarot-screen')" class="hover:text-amber-400 transition-colors" data-i18n="btnGoToAboutShort">서비스 소개</button>
<button onclick="showScreen('privacy-screen')" class="hover:text-amber-400 transition-colors" data-i18n="linkPrivacy">개인정보처리방침</button>
<button onclick="showScreen('terms-screen')" class="hover:text-amber-400 transition-colors" data-i18n="linkTerms">이용약관</button>
<button onclick="showScreen('contact-screen')" class="hover:text-amber-400 transition-colors" data-i18n="btnContact">제휴 및 협업 문의</button>
</div>
<p>© 2026 DreamTarot. All rights reserved.</p>
</footer>
</div>

<!-- ========================================== -->
<!-- 서비스 소개 및 가이드 화면 (about-dreamtarot-screen) -->
<!-- ========================================== -->
<div id="about-dreamtarot-screen" class="hidden flex-col items-center py-16 px-4 min-h-screen fade-in w-full max-w-5xl mx-auto">
    <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-amber-100 mb-4 font-serif tracking-widest" data-i18n="aboutMainTitle">꿈타로 가이드</h2>
        <p class="text-purple-300" data-i18n="aboutMainSubtitle">당신의 운명을 이해하는 첫 번째 걸음</p>
    </div>

    <!-- 1. 서비스 소개 섹션 (간결하게 통합) -->
    <div class="w-full mb-16">
        <div class="bg-slate-900/40 backdrop-blur-sm p-8 rounded-2xl border border-purple-500/20 leading-relaxed">
            <h3 class="text-amber-200 text-xl font-bold mb-6 flex items-center justify-center md:justify-start">
                <i data-lucide="sparkles" class="w-5 h-5 mr-2"></i> <span data-i18n="aboutTitle1">꿈타로 서비스 소개</span>
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <p class="text-slate-300 text-sm md:text-base" data-i18n="aboutCombinedText1">꿈타로는 고전 타로의 상징 체계와 현대적인 데이터 분석을 결합하여 개인에게 최적화된 리딩을 제공합니다. 78장의 카드가 지닌 고유한 에너지는 사용자의 현재 상황과 공명하여 다각도의 통찰력을 제시하며, 스스로를 성찰하고 더 나은 미래를 설계할 수 있도록 돕는 '운명의 조언자' 역할을 합니다.</p>
                <p class="text-slate-300 text-sm md:text-base" data-i18n="aboutCombinedText2">모든 리딩 결과는 사주 명리학의 '기운(Energy)' 개념과 타로의 '직관(Intuition)'을 교차 분석하여 생성됩니다. 연애, 직업, 금전 등 삶의 주요 영역에 대해 구체적이고 현실적인 조언을 담고 있으며, 매일의 흐름을 파악하고 중요한 결정의 순간에 별의 지혜를 빌려드립니다.</p>
            </div>
        </div>
    </div>

    <!-- 2. 지식 창고 (가이드) 섹션 -->
    <div class="w-full space-y-16">
        <!-- 타로 섹션 -->
        <section>
            <div class="flex items-center mb-8">
                <div class="h-px flex-1 bg-gradient-to-r from-transparent to-amber-500/30"></div>
                <h3 class="mx-4 text-2xl font-bold text-amber-100 font-serif" data-i18n="guideTitle">타로 지식 창고</h3>
                <div class="h-px flex-1 bg-gradient-to-l from-transparent to-amber-500/30"></div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-slate-900/60 p-6 rounded-2xl border border-amber-500/10">
                    <h4 class="text-amber-400 font-bold mb-3" data-i18n="guideArticle1Title">타로 카드의 유래</h4>
                    <p class="text-slate-400 text-xs leading-loose" data-i18n="guideArticle1Text">타로 카드는 15세기 중반 이탈리아에서 시작된 것으로 알려져 있습니다. 초기에는 게임용으로 사용되었으나, 점차 상징 체계가 더해지며 인간의 무의식과 우주의 흐름을 읽는 도구로 발전했습니다.</p>
                </div>
                <div class="bg-slate-900/60 p-6 rounded-2xl border border-amber-500/10">
                    <h4 class="text-amber-400 font-bold mb-3" data-i18n="guideArticle2Title">아르카나의 구성</h4>
                    <p class="text-slate-400 text-xs leading-loose" data-i18n="guideArticle2Text">타로는 22장의 메이저 아르카나와 56장의 마이너 아르카나로 나뉩니다. 메이저는 인생의 큰 전환점을, 마이너는 일상적인 사건과 구체적인 감정의 흐름을 나타냅니다.</p>
                </div>
                <div class="bg-slate-900/60 p-6 rounded-2xl border border-amber-500/10">
                    <h4 class="text-amber-400 font-bold mb-3" data-i18n="guideArticle3Title">올바른 리딩 태도</h4>
                    <p class="text-slate-400 text-xs leading-loose" data-i18n="guideArticle3Text">운세는 결정된 미래가 아니라 더 나은 선택을 돕는 이정표입니다. 결과를 맹신하기보다는 자신의 내면을 비추어보는 거울로 삼을 때 가장 큰 가치를 얻을 수 있습니다.</p>
                </div>
            </div>
        </section>

        <!-- 명리학 섹션 -->
        <section>
            <div class="flex items-center mb-8">
                <div class="h-px flex-1 bg-gradient-to-r from-transparent to-purple-500/30"></div>
                <h3 class="mx-4 text-2xl font-bold text-amber-100 font-serif" data-i18n="sajuGuideTitle">사주 명리학 가이드</h3>
                <div class="h-px flex-1 bg-gradient-to-l from-transparent to-purple-500/30"></div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-slate-900/60 p-6 rounded-2xl border border-purple-500/10">
                    <h4 class="text-amber-400 font-bold mb-3" data-i18n="sajuArticle1Title">사주팔자의 원리</h4>
                    <p class="text-slate-400 text-xs leading-loose" data-i18n="sajuArticle1Text">사주(四柱)는 태어난 년, 월, 일, 시의 네 기둥을 의미합니다. 이는 태어난 순간 우주의 기운이 어떻게 배열되었는지를 보여주는 에너지 지도로, 개인의 선천적 성향 분석의 기초가 됩니다.</p>
                </div>
                <div class="bg-slate-900/60 p-6 rounded-2xl border border-purple-500/10">
                    <h4 class="text-amber-400 font-bold mb-3" data-i18n="sajuArticle2Title">음양오행의 조화</h4>
                    <p class="text-slate-400 text-xs leading-loose" data-i18n="sajuArticle2Text">명리학의 핵심은 다섯 가지 성질(목, 화, 토, 금, 수)이 상생하고 상극하는 원리에 있습니다. 부족한 기운을 채우고 넘치는 기운을 조절하는 과정이 곧 삶의 지혜입니다.</p>
                </div>
                <div class="bg-slate-900/60 p-6 rounded-2xl border border-purple-500/10">
                    <h4 class="text-amber-400 font-bold mb-3" data-i18n="sajuArticle3Title">대운과 세운의 흐름</h4>
                    <p class="text-slate-400 text-xs leading-loose" data-i18n="sajuArticle3Text">10년 주기의 '대운'과 1년 단위의 '세운'은 삶의 계절이 어떻게 바뀌는지를 알려줍니다. 흐름을 미리 알면 때를 기다리거나 용기 있게 나아갈 타이밍을 결정할 수 있습니다.</p>
                </div>
            </div>
        </section>
    </div>

    <div class="text-center py-12">
        <button onclick="goBack()" class="bg-slate-800 hover:bg-slate-700 text-slate-300 py-3 px-10 rounded-lg transition-colors font-bold shadow-lg" data-i18n="btnClose">돌아가기</button>
    </div>
</div>

<!-- ========================================== -->
<!-- 개인정보처리방침 화면 (privacy-screen) -->
<!-- ========================================== -->
<div id="privacy-screen" class="hidden flex-col items-center py-16 px-4 min-h-screen fade-in">
<div class="w-full max-w-3xl bg-slate-900/80 backdrop-blur-md p-8 rounded-2xl border border-purple-500/30">
<h2 class="text-2xl font-bold text-amber-100 mb-6 font-serif" data-i18n="privacyTitle">개인정보처리방침</h2>
<div class="text-sm text-slate-300 space-y-4 overflow-y-auto max-h-[60vh] pr-4 custom-scrollbar leading-relaxed" data-i18n="privacyContent">
<p>꿈타로(이하 '회사')는 이용자의 개인정보를 중요시하며, '개인정보 보호법' 등 관련 법령을 준수합니다.</p>
<h4 class="text-amber-200 font-bold mt-4">1. 수집하는 개인정보 항목</h4>
<p>- 필수항목: 이메일, 이름, 생년월일, 성별, 결혼 여부<br/>- 수집방법: 서비스 이용 단계에서의 직접 입력</p>
<h4 class="text-amber-200 font-bold mt-4">2. 개인정보의 수집 및 이용목적</h4>
<p>- 타로 리딩 및 운세 서비스 결과 제공<br/>- 회원 관리 및 본인 확인<br/>- 서비스 개선 및 통계 분석</p>
<h4 class="text-amber-200 font-bold mt-4">3. 개인정보의 보유 및 이용기간</h4>
<p>이용자의 개인정보는 원칙적으로 회원 탈퇴 시까지 보유하며, 법령에서 정한 기간 동안 안전하게 보관 후 파기합니다.</p>
<h4 class="text-amber-200 font-bold mt-4">4. 개인정보의 파기절차 및 방법</h4>
<p>전자적 파일 형태의 정보는 기록을 재생할 수 없는 기술적 방법을 사용하여 삭제합니다.</p>
</div>
<button onclick="goBack()" class="mt-8 bg-slate-800 hover:bg-slate-700 text-slate-300 py-2 px-6 rounded-lg transition-colors font-bold" data-i18n="btnClose">닫기 (뒤로가기)</button>
</div>
</div>

<!-- ========================================== -->
<!-- 이용약관 화면 (terms-screen) -->
<!-- ========================================== -->
<div id="terms-screen" class="hidden flex-col items-center py-16 px-4 min-h-screen fade-in">
<div class="w-full max-w-3xl bg-slate-900/80 backdrop-blur-md p-8 rounded-2xl border border-purple-500/30">
<h2 class="text-2xl font-bold text-amber-100 mb-6 font-serif" data-i18n="termsTitle">이용약관</h2>
<div class="text-sm text-slate-300 space-y-4 overflow-y-auto max-h-[60vh] pr-4 custom-scrollbar leading-relaxed" data-i18n="termsContent">
<h4 class="text-amber-200 font-bold">제 1 조 (목적)</h4>
<p>본 약관은 꿈타로가 제공하는 운세 서비스의 이용 조건 및 절차에 관한 사항을 규정함을 목적으로 합니다.</p>
<h4 class="text-amber-200 font-bold mt-4">제 2 조 (서비스의 성격)</h4>
<p>본 서비스가 제공하는 타로 리딩 결과는 오락 및 참고용이며, 이용자의 중대한 결정에 대한 법적 책임을 지지 않습니다.</p>
<h4 class="text-amber-200 font-bold mt-4">제 3 조 (이용자의 의무)</h4>
<p>이용자는 본인의 정보를 정확히 입력해야 하며, 타인의 정보를 도용하여 발생하는 문제에 대한 책임은 이용자에게 있습니다.</p>
</div>
<button onclick="goBack()" class="mt-8 bg-slate-800 hover:bg-slate-700 text-slate-300 py-2 px-6 rounded-lg transition-colors font-bold" data-i18n="btnClose">닫기 (뒤로가기)</button>
</div>
</div>

<!-- ========================================== -->
<!-- 3단계: 타로 종류 선택 화면 (selection-screen) -->
<!-- ========================================== -->
<div id="selection-screen" class="hidden flex-col items-center justify-start md:justify-center min-h-screen p-4 pt-20 md:pt-4 w-full max-w-4xl mx-auto fade-in">
<div class="absolute top-6 left-6 z-50">
<button onclick="handleLogout()" class="text-xs text-slate-500 hover:text-amber-400 transition-colors flex items-center gap-1">
<i data-lucide="log-out" class="w-3 h-3"></i> <span data-i18n="btnLogout">로그아웃</span>
</button>
</div>
<div class="text-center mb-10">
<h2 class="text-3xl md:text-4xl font-bold text-amber-100 mb-4 font-serif">
<span id="display-name">사용자</span><span data-i18n="selGreeting">님, 환영합니다.</span>
</h2>
<p class="text-purple-300 text-lg" data-i18n="selSubtitle">어떤 운명의 속삭임을 듣고 싶으신가요?</p>
</div>

<div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full mb-12">
<!-- 궁합 타로 -->
<button onclick="selectTarot('love')" class="flex flex-col items-center text-center p-8 bg-slate-900/60 backdrop-blur-sm border border-purple-500/30 rounded-2xl transition-all duration-300 group cursor-pointer hover:bg-rose-900/30 hover:border-rose-400/50 transform hover:-translate-y-2 hover:shadow-2xl hover:shadow-purple-900/50">
<div class="p-4 rounded-full bg-slate-800 mb-6 group-hover:scale-110 transition-transform text-rose-400">
<i data-lucide="heart" class="w-10 h-10"></i>
</div>
<h3 class="text-2xl font-bold text-amber-100 mb-3 font-serif" data-i18n="tarotLove">궁합 타로</h3>
<p class="text-purple-300 text-sm leading-relaxed" data-i18n="tarotLoveDesc">당신과 그 사람을 잇는 인연의 끈을 확인해보세요.</p>
<div class="mt-6 opacity-0 group-hover:opacity-100 transition-opacity">
<span class="inline-flex items-center text-amber-400 text-sm font-medium">
<span data-i18n="btnSelect">선택하기</span> <i data-lucide="chevron-right" class="w-4 h-4 ml-1"></i>
</span>
</div>
</button>

<!-- 올해운 타로 -->
<button onclick="selectTarot('year')" class="flex flex-col items-center text-center p-8 bg-slate-900/60 backdrop-blur-sm border border-purple-500/30 rounded-2xl transition-all duration-300 group cursor-pointer hover:bg-amber-900/30 hover:border-amber-400/50 transform hover:-translate-y-2 hover:shadow-2xl hover:shadow-purple-900/50">
<div class="p-4 rounded-full bg-slate-800 mb-6 group-hover:scale-110 transition-transform text-amber-400">
<i data-lucide="sun" class="w-10 h-10"></i>
</div>
<h3 class="text-2xl font-bold text-amber-100 mb-3 font-serif" data-i18n="tarotYear">올해운 타로</h3>
<p class="text-purple-300 text-sm leading-relaxed" data-i18n="tarotYearDesc">올 한 해 당신의 삶에 펼쳐질 전반적인 흐름을 읽어드립니다.</p>
<div class="mt-6 opacity-0 group-hover:opacity-100 transition-opacity">
<span class="inline-flex items-center text-amber-400 text-sm font-medium">
<span data-i18n="btnSelect">선택하기</span> <i data-lucide="chevron-right" class="w-4 h-4 ml-1"></i>
</span>
</div>
</button>

<!-- 직업 타로 -->
<button onclick="selectTarot('career')" class="flex flex-col items-center text-center p-8 bg-slate-900/60 backdrop-blur-sm border border-purple-500/30 rounded-2xl transition-all duration-300 group cursor-pointer hover:bg-emerald-900/30 hover:border-emerald-400/50 transform hover:-translate-y-2 hover:shadow-2xl hover:shadow-purple-900/50">
<div class="p-4 rounded-full bg-slate-800 mb-6 group-hover:scale-110 transition-transform text-emerald-400">
<i data-lucide="briefcase" class="w-10 h-10"></i>
</div>
<h3 class="text-2xl font-bold text-amber-100 mb-3 font-serif" data-i18n="tarotCareer">직업 타로</h3>
<p class="text-purple-300 text-sm leading-relaxed" data-i18n="tarotCareerDesc">당신의 재능이 빛날 길과 금전의 흐름을 조언해드립니다.</p>
<div class="mt-6 opacity-0 group-hover:opacity-100 transition-opacity">
<span class="inline-flex items-center text-amber-400 text-sm font-medium">
<span data-i18n="btnSelect">선택하기</span> <i data-lucide="chevron-right" class="w-4 h-4 ml-1"></i>
</span>
</div>
</button>
</div>

<!-- 하단: 오늘운 타로 -->
<div class="w-full flex justify-center mb-16">
<button onclick="selectTarot('today')" class="w-full md:w-3/4 flex flex-col md:flex-row items-center text-center md:text-left p-6 md:p-8 bg-slate-900/60 backdrop-blur-sm border border-sky-500/30 rounded-2xl transition-all duration-300 group cursor-pointer hover:bg-sky-900/30 hover:border-sky-400/50 transform hover:-translate-y-2 hover:shadow-2xl hover:shadow-sky-900/50">
<div class="p-4 rounded-full bg-slate-800 mb-4 md:mb-0 md:mr-6 group-hover:scale-110 transition-transform text-sky-400 shrink-0">
<i data-lucide="clock" class="w-10 h-10"></i>
</div>
<div class="flex-1">
<h3 class="text-2xl font-bold text-amber-100 mb-2 font-serif" data-i18n="tarotToday">오늘운 타로</h3>
<p class="text-purple-300 text-sm leading-relaxed" data-i18n="tarotTodayDesc">오늘 하루의 아침, 낮, 저녁 흐름을 3장의 카드로 가볍게 살펴봅니다.</p>
</div>
<div class="mt-4 md:mt-0 md:ml-4 opacity-0 group-hover:opacity-100 transition-opacity flex items-center shrink-0">
<span class="inline-flex items-center text-amber-400 text-sm font-medium">
<span data-i18n="btnSelect">선택하기</span> <i data-lucide="chevron-right" class="w-4 h-4 ml-1"></i>
</span>
</div>
</button>
</div>
</div>

<!-- ========================================== -->
<!-- 제휴 문의 화면 (contact-screen) -->
<!-- ========================================== -->
<div id="contact-screen" class="hidden flex-col items-center justify-start md:justify-center min-h-screen p-4 pt-16 md:pt-4 fade-in">
<div class="text-center mb-8">
<i data-lucide="mail" class="w-12 h-12 text-amber-400 mx-auto mb-4"></i>
<h2 class="text-3xl font-bold text-amber-100 mb-2 font-serif" data-i18n="contactTitle">함께 꿈을 그리다</h2>
<p class="text-purple-300" data-i18n="contactSubtitle">꿈타로와 함께할 비즈니스 파트너를 기다립니다.</p>
</div>

<div class="bg-slate-900/80 backdrop-blur-md p-8 rounded-2xl shadow-2xl shadow-purple-900/50 w-full max-w-lg border border-purple-500/30">
<form action="https://formspree.io/f/xqedgezb" method="POST" class="space-y-5">
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label class="block text-sm font-medium text-purple-300 mb-1" data-i18n="labelContactName">업체명/성함</label>
<input type="text" name="name" required class="w-full bg-slate-800 border border-purple-500/50 rounded-lg px-4 py-2 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors" placeholder="홍길동" />
</div>
<div>
<label class="block text-sm font-medium text-purple-300 mb-1" data-i18n="labelContactEmail">회신 이메일</label>
<input type="email" name="email" required class="w-full bg-slate-800 border border-purple-500/50 rounded-lg px-4 py-2 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors" placeholder="email@example.com" />
</div>
</div>
<div>
<label class="block text-sm font-medium text-purple-300 mb-1" data-i18n="labelContactSubject">문의 제목</label>
<input type="text" name="subject" required class="w-full bg-slate-800 border border-purple-500/50 rounded-lg px-4 py-2 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors" placeholder="제휴 문의드립니다" />
</div>
<div>
<label class="block text-sm font-medium text-purple-300 mb-1" data-i18n="labelContactMessage">상세 내용</label>
<textarea name="message" rows="4" required class="w-full bg-slate-800 border border-purple-500/50 rounded-lg px-4 py-2 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors resize-none" placeholder="문의하실 내용을 입력해주세요."></textarea>
</div>

<div class="flex gap-3 pt-2">
<button type="button" onclick="goBack()" class="w-1/3 bg-slate-800 hover:bg-slate-700 text-slate-300 font-bold py-3 px-4 rounded-lg transition-colors" data-i18n="btnBack">
뒤로
</button>
<button type="submit" class="w-2/3 bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 text-slate-900 font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-amber-500/50 transition-all flex justify-center items-center">
<span data-i18n="btnSubmitContact">문의 보내기</span> <i data-lucide="send" class="ml-2 w-5 h-5"></i>
</button>
</div>
</form>
</div>
</div>

<!-- ========================================== -->
<!-- 3-5단계: 상대방 정보 입력 화면 (partner-profile-screen) -->
<!-- ========================================== -->
<div id="partner-profile-screen" class="hidden flex-col items-center justify-start md:justify-center min-h-screen p-4 pt-16 md:pt-4 fade-in">
<div class="text-center mb-8">
<i data-lucide="users" class="w-12 h-12 text-rose-400 mx-auto mb-4"></i>
<h2 class="text-3xl font-bold text-amber-100 mb-2 font-serif" data-i18n="partnerTitle">인연의 끈을 찾아서</h2>
<p class="text-purple-300" data-i18n="partnerSubtitle">궁합을 확인하기 위해 상대방의 정보를 입력해주세요.</p>
</div>

<div class="bg-slate-900/80 backdrop-blur-md p-8 rounded-2xl shadow-2xl shadow-rose-900/50 w-full max-w-md border border-rose-500/30">
<form id="partner-profile-form" class="space-y-6">

<div>
<label class="flex items-center text-sm font-medium text-rose-300 mb-2">
<i data-lucide="user" class="w-4 h-4 mr-2"></i> <span data-i18n="labelPartnerName">상대방 이름</span>
</label>
<input type="text" id="partner-name-input" required class="w-full bg-slate-800 border border-rose-500/50 rounded-lg px-4 py-3 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors" data-i18n="phPartnerName" placeholder="성춘향" />
</div>

<div>
<label class="flex items-center text-sm font-medium text-rose-300 mb-2">
<i data-lucide="calendar" class="w-4 h-4 mr-2"></i> <span data-i18n="labelBirth">생년월일</span>
</label>
<div class="flex gap-2 items-center">
<input type="text" id="partner-year-input" required inputmode="numeric" pattern="[0-9]*" maxlength="4" class="w-20 bg-slate-800 border border-rose-500/50 rounded-lg px-2 py-3 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors text-center" placeholder="YYYY" oninput="this.value = this.value.replace(/[^0-9]/g, ''); if(this.value.length === 4) document.getElementById('partner-month-input').focus();" />
<span class="text-rose-500 font-bold">-</span>
<input type="text" id="partner-month-input" required inputmode="numeric" pattern="[0-9]*" maxlength="2" class="w-14 bg-slate-800 border border-rose-500/50 rounded-lg px-2 py-3 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors text-center" placeholder="MM" oninput="this.value = this.value.replace(/[^0-9]/g, ''); if(this.value.length === 2) document.getElementById('partner-day-input').focus();" />
<span class="text-rose-500 font-bold">-</span>
<input type="text" id="partner-day-input" required inputmode="numeric" pattern="[0-9]*" maxlength="2" class="w-14 bg-slate-800 border border-rose-500/50 rounded-lg px-2 py-3 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors text-center" placeholder="DD" oninput="this.value = this.value.replace(/[^0-9]/g, ''); if(this.value.length === 2) document.getElementById('partner-calendar-type-input').focus();" />

<select id="partner-calendar-type-input" class="ml-2 flex-1 bg-slate-800 border border-rose-500/50 rounded-lg px-2 py-3 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors">
<option value="solar" data-i18n="optSolar">양력</option>
<option value="lunar" data-i18n="optLunar">음력</option>
</select>
</div>
</div>

<div>
<label class="block text-sm font-medium text-rose-300 mb-2" data-i18n="labelGender">성별</label>
<div class="grid grid-cols-3 gap-3">
<label class="cursor-pointer">
<input type="radio" name="partner-gender" value="male" class="sr-only peer" />
<div class="text-center bg-slate-800 border border-rose-500/50 rounded-lg py-2 text-sm text-rose-300 transition-all" data-i18n="genMale">남성</div>
</label>
<label class="cursor-pointer">
<input type="radio" name="partner-gender" value="female" class="sr-only peer" />
<div class="text-center bg-slate-800 border border-rose-500/50 rounded-lg py-2 text-sm text-rose-300 transition-all" data-i18n="genFemale">여성</div>
</label>
<label class="cursor-pointer">
<input type="radio" name="partner-gender" value="none" class="sr-only peer" checked />
<div class="text-center bg-slate-800 border border-rose-500/50 rounded-lg py-2 text-sm text-rose-300 transition-all" data-i18n="genNone">선택안함</div>
</label>
</div>
</div>

<div>
<label class="flex items-center text-sm font-medium text-rose-300 mb-2">
<i data-lucide="message-circle" class="w-4 h-4 mr-2"></i> <span data-i18n="labelQuestion">궁금한 점이나 고민 (선택사항)</span>
</label>
<textarea id="partner-question-input" rows="2" class="w-full bg-slate-800 border border-rose-500/50 rounded-lg px-4 py-3 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors resize-none" data-i18n="phPartnerQ" placeholder="예: 앞으로 우리가 좋은 인연으로 발전할 수 있을까요?"></textarea>
</div>

<div class="flex gap-3 mt-4">
<button type="button" onclick="goToSelection()" class="w-1/3 bg-slate-800 hover:bg-slate-700 text-slate-300 font-bold py-3 px-4 rounded-lg transition-colors" data-i18n="btnBack">
뒤로
</button>
<button type="submit" class="w-2/3 bg-gradient-to-r from-rose-600 to-rose-500 hover:from-rose-500 hover:to-rose-400 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-rose-500/50 transition-all flex justify-center items-center">
<span data-i18n="btnSubmitLove">궁합 확인하기</span> <i data-lucide="heart" class="ml-2 w-5 h-5"></i>
</button>
</div>
</form>
</div>
</div>

<!-- ========================================== -->
<!-- 직업 타로 질문 입력 화면 (career-profile-screen) -->
<!-- ========================================== -->
<div id="career-profile-screen" class="hidden flex-col items-center justify-start md:justify-center min-h-screen p-4 pt-16 md:pt-4 fade-in">
<div class="text-center mb-8">
<i data-lucide="briefcase" class="w-12 h-12 text-emerald-400 mx-auto mb-4"></i>
<h2 class="text-3xl font-bold text-amber-100 mb-2 font-serif" data-i18n="careerTitle">직업과 재물의 길을 묻다</h2>
<p class="text-purple-300" data-i18n="careerSubtitle">더 객관적이고 깊이 있는 분석을 위해, 현재 마주하신 고민을 적어주세요.</p>
</div>

<div class="bg-slate-900/80 backdrop-blur-md p-8 rounded-2xl shadow-2xl shadow-emerald-900/50 w-full max-w-md border border-emerald-500/30">
<form id="career-profile-form" class="space-y-6">

<div>
<label class="flex items-center text-sm font-medium text-emerald-300 mb-2">
<i data-lucide="message-circle" class="w-4 h-4 mr-2"></i> <span data-i18n="labelCareerQ">직업/재물 관련 구체적인 질문 (선택사항)</span>
</label>
<textarea id="career-question-input" rows="3" class="w-full bg-slate-800 border border-emerald-500/50 rounded-lg px-4 py-3 text-amber-100 focus:outline-none focus:border-amber-400 transition-colors resize-none" data-i18n="phCareerQ" placeholder="예: 이직을 준비 중인데 올해 긍정적인 변화가 있을까요? 혹은 현재 진행 중인 프로젝트의 방향성이 맞는지 궁금합니다."></textarea>
</div>

<div class="flex gap-3 mt-4">
<button type="button" onclick="goToSelection()" class="w-1/3 bg-slate-800 hover:bg-slate-700 text-slate-300 font-bold py-3 px-4 rounded-lg transition-colors" data-i18n="btnBack">
뒤로
</button>
<button type="submit" class="w-2/3 bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-emerald-500/50 transition-all flex justify-center items-center">
<span data-i18n="btnSubmitCareer">흐름 분석하기</span> <i data-lucide="briefcase" class="ml-2 w-5 h-5"></i>
</button>
</div>
</form>
</div>
</div>

<!-- ========================================== -->
<!-- 오늘운 타로 질문 입력 화면 (today-profile-screen) -->
<!-- ========================================== -->
<div id="today-profile-screen" class="hidden flex-col items-center justify-start md:justify-center min-h-screen p-4 pt-16 md:pt-4 fade-in">
<div class="text-center mb-8">
<i data-lucide="clock" class="w-12 h-12 text-sky-400 mx-auto mb-4"></i>
<h2 class="text-3xl font-bold text-amber-100 mb-2 font-serif" data-i18n="todayTitle">오늘의 흐름을 묻다</h2>
<p class="text-purple-300" data-i18n="todaySubtitle">오늘 하루 특히 집중하고 싶은 일이나 고민이 있으신가요?</p>
</div>

<div class="bg-slate-900/80 backdrop-blur-md p-8 rounded-2xl shadow-2xl shadow-sky-900/50 w-full max-w-md border border-sky-500/30">
<form id="today-profile-form" class="space-y-6">

<div>
<label class="flex items-center text-sm font-medium text-sky-300 mb-2">
<i data-lucide="message-circle" class="w-4 h-4 mr-2"></i> <span data-i18n="labelTodayQ">오늘의 질문이나 다짐 (선택사항)</span>
</label>
<textarea id="today-question-input" rows="3" class="w-full bg-slate-800 border border-sky-500/50 rounded-lg px-4 py-3 text-amber-100 focus:outline-none focus:border-sky-400 transition-colors resize-none" data-i18n="phTodayQ" placeholder="예: 오늘 중요한 미팅이 있는데 잘 풀릴까요? 혹은 오늘 하루를 보람차게 보내려면 무엇에 집중해야 할까요?"></textarea>
</div>

<div class="flex gap-3 mt-4">
<button type="button" onclick="goToSelection()" class="w-1/3 bg-slate-800 hover:bg-slate-700 text-slate-300 font-bold py-3 px-4 rounded-lg transition-colors" data-i18n="btnBack">
뒤로
</button>
<button type="submit" class="w-2/3 bg-gradient-to-r from-sky-600 to-sky-500 hover:from-sky-500 hover:to-sky-400 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-sky-500/50 transition-all flex justify-center items-center">
<span data-i18n="btnSubmitToday">오늘의 운세 보기</span> <i data-lucide="sparkles" class="ml-2 w-5 h-5"></i>
</button>
</div>
</form>
</div>
</div>

<!-- ========================================== -->
<!-- 4단계: 타로 리딩 연출 화면 (reading-screen) -->
<!-- ========================================== -->
<div id="reading-screen" class="hidden flex-col items-center justify-center min-h-screen p-4 text-center fade-in">
<i data-lucide="sparkles" class="w-16 h-16 text-amber-400 animate-pulse mb-6"></i>
<h2 class="text-3xl font-bold text-amber-100 mb-4 font-serif" data-i18n="shuffleTitle">카드를 섞고 있습니다...</h2>
<p class="text-purple-300" data-i18n="shuffleSubtitle">잠시만 마음을 비우고 기다려주세요.</p>
</div>

<!-- ========================================== -->
<!-- 5단계: 타로 카드 뽑기 화면 (draw-screen) -->
<!-- ========================================== -->
<div id="draw-screen" class="hidden flex-col items-center justify-center min-h-screen p-4 w-full max-w-4xl mx-auto fade-in">
<div class="text-center mb-6">
<h2 class="text-2xl md:text-3xl font-bold text-amber-100 mb-2 font-serif" data-i18n="drawTitle">운명의 카드 선택</h2>
<p id="draw-instruction" class="text-purple-300 text-lg"></p>
</div>

<!-- 상단: 엎어져 있는 카드 덱 -->
<div id="card-deck-container" class="tarot-card-deck mb-8 min-h-[120px]"></div>

<!-- 하단: 뽑힌 카드 배열 구조 (스프레드) -->
<div class="w-full max-w-2xl bg-slate-900/60 backdrop-blur-sm border border-purple-500/30 rounded-2xl p-6 shadow-2xl shadow-purple-900/50">
<div id="slots-container" class="flex justify-center flex-wrap gap-3 md:gap-6"></div>
</div>

<!-- 결과 보기 버튼 -->
<div id="result-action-container" class="mt-8 opacity-0 pointer-events-none transition-opacity duration-500">
<button onclick="showResultScreen()" class="bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 text-slate-900 font-bold py-3 px-8 rounded-full shadow-[0_0_15px_rgba(251,191,36,0.5)] hover:shadow-[0_0_25px_rgba(251,191,36,0.8)] transition-all flex items-center text-lg">
<span data-i18n="btnShowResult">운명의 해석 듣기</span> <i data-lucide="sparkles" class="ml-2 w-5 h-5"></i>
</button>
</div>
</div>

<!-- ========================================== -->
<!-- 6단계: 타로 결과 및 해석 화면 (result-screen) -->
<!-- ========================================== -->
<div id="result-screen" class="hidden flex-col items-center py-12 px-4 w-full max-w-5xl mx-auto fade-in">
<div class="text-center mb-10">
<h2 class="text-3xl md:text-4xl font-bold text-amber-100 mb-4 font-serif" data-i18n="resTitle">별의 궤적이 그리는 운명</h2>
<p class="text-purple-300 text-lg" data-i18n="resSubtitle">당신이 선택한 카드가 전하는 다정한 메시지입니다.</p>
</div>

<div class="star-spread-container mb-12">
<div id="spread-svg-container"></div>
<div id="star-cards-container"></div>
</div>

<div class="w-full bg-slate-900/80 backdrop-blur-md border border-amber-500/30 rounded-2xl p-6 md:p-10 shadow-2xl shadow-purple-900/50">
<div class="flex items-center justify-center mb-6 pb-6 border-b border-purple-500/30">
<i data-lucide="scroll-text" class="w-8 h-8 text-amber-400 mr-3"></i>
<h3 class="text-2xl font-bold text-amber-100 font-serif" data-i18n="resHeader">상세 해석</h3>
</div>

<div id="interpretation-content" class="space-y-6 text-purple-100 leading-relaxed text-base md:text-lg"></div>

<div class="mt-10 pt-8 border-t border-purple-500/30 flex flex-col items-center gap-6">
    <p class="text-amber-200/70 text-sm font-medium" data-i18n="btnShare">운명 공유하기</p>
    <div class="flex gap-4">
        <!-- URL 복사 -->
        <button onclick="shareURL()" class="w-12 h-12 rounded-full bg-slate-800 border border-purple-500/30 flex items-center justify-center hover:bg-purple-900/50 hover:border-purple-400 transition-all text-purple-300" title="Copy Link">
            <i data-lucide="link" class="w-5 h-5"></i>
        </button>
        <!-- 트위터 공유 -->
        <button onclick="shareTwitter()" class="w-12 h-12 rounded-full bg-slate-800 border border-purple-500/30 flex items-center justify-center hover:bg-sky-900/50 hover:border-sky-400 transition-all text-sky-400" title="Share on Twitter">
            <i data-lucide="twitter" class="w-5 h-5"></i>
        </button>
        <!-- 카카오톡 공유 (이미지 아이콘 활용) -->
        <button onclick="shareKakao()" class="w-12 h-12 rounded-full bg-[#FEE500] border border-transparent flex items-center justify-center hover:brightness-95 transition-all text-[#3C1E1E]" title="Share on KakaoTalk">
            <i data-lucide="message-circle" class="w-5 h-5 fill-current"></i>
        </button>
    </div>
</div>

<div class="mt-8 text-center">
<button onclick="goToSelection()" class="bg-slate-800 hover:bg-slate-700 text-amber-100 border border-amber-500/50 font-bold py-3 px-8 rounded-lg transition-all flex items-center justify-center mx-auto">
<i data-lucide="rotate-ccw" class="mr-2 w-5 h-5"></i> <span data-i18n="btnRestart">새로운 질문하기</span>
</button>
</div>
</div>
</div>

</div>

<!-- JavaScript 로직 -->
<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js" integrity="sha384-l6S7Ad97pq9vSXPAdSbcSTbtfSbh8SPrsdScFBfP7SCDlsIn6ayS9ToSIdofZ60n" crossorigin="anonymous"></script>
<script>
// 카카오 초기화 (사용자 앱 키로 변경 권장)
// 주의: 실제 작동을 위해서는 카카오 개발자 콘솔에서 발급받은 'JavaScript 키'를 아래에 넣어야 합니다.
try {
    if (typeof Kakao !== 'undefined') {
        const KAKAO_KEY = 'YOUR_KAKAO_APP_KEY'; 
        if (KAKAO_KEY !== 'YOUR_KAKAO_APP_KEY') {
            Kakao.init(KAKAO_KEY);
        }
    }
} catch (e) {
    console.warn("Kakao SDK initialization failed:", e);
}

// --- 공유 기능 함수들 ---
function shareURL() {
    const url = "https://product-taro1.pages.dev/";
    navigator.clipboard.writeText(url).then(() => {
        showMessage(uiTranslations.msgCopySuccess, "info");
    });
}

function shareTwitter() {
    const text = uiTranslations.msgShareTitle[currentLang];
    const url = "https://product-taro1.pages.dev/";
    window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
}

function shareKakao() {
    if (typeof Kakao !== 'undefined' && Kakao.isInitialized()) {
        Kakao.Share.sendDefault({
            objectType: 'feed',
            content: {
                title: uiTranslations.msgShareTitle['ko'],
                description: uiTranslations.msgShareText['ko'],
                imageUrl: 'https://product-taro1.pages.dev/card-back.png?v=2',
                link: {
                    mobileWebUrl: 'https://product-taro1.pages.dev/',
                    webUrl: 'https://product-taro1.pages.dev/',
                },
            },
            buttons: [
                {
                    title: '운명 확인하기',
                    link: {
                        mobileWebUrl: 'https://product-taro1.pages.dev/',
                        webUrl: 'https://product-taro1.pages.dev/',
                    },
                },
            ],
        });
    } else {
        // SDK 미설정 시 URL 복사로 대체 안내
        shareURL();
    }
}

// --- 0. 다국어 데이터 (i18n Dictionary) ---
const uiTranslations = {
appTitle: { ko: "꿈타로", en: "DreamTarot" },
appSubtitle: { ko: "당신의 운명을 비춰보는 신비로운 거울", en: "A mystical mirror reflecting your destiny" },

guideTitle: { ko: "타로 지식 창고", en: "Tarot Knowledge" },
guideArticle1Title: { ko: "타로 카드의 유래", en: "Origins of Tarot" },
guideArticle1Text: { ko: "타로 카드는 15세기 중반 이탈리아에서 시작된 것으로 알려져 있습니다.", en: "Tarot cards originated in mid-15th century Italy." },
guideArticle2Title: { ko: "아르카나의 구성", en: "Arcana Structure" },
guideArticle2Text: { ko: "타로는 22장의 메이저 아르카나와 56장의 마이너 아르카나로 나뉩니다.", en: "Tarot consists of 22 Major and 56 Minor Arcana cards." },
guideArticle3Title: { ko: "올바른 리딩 태도", en: "Reading Attitude" },
guideArticle3Text: { ko: "운세는 더 나은 선택을 돕는 이정표입니다. 내면을 비추는 거울로 삼으세요.", en: "Fortune is a guide for better choices. Use it as a mirror for reflection." },

sajuGuideTitle: { ko: "사주 명리학 가이드", en: "Saju Guide" },
sajuArticle1Title: { ko: "사주팔자의 원리", en: "Principles of Saju" },
sajuArticle1Text: { ko: "사주는 태어난 년, 월, 일, 시의 네 기둥을 의미합니다.", en: "Saju refers to the four pillars: year, month, day, and hour of birth." },
sajuArticle2Title: { ko: "음양오행의 조화", en: "Five Elements Harmony" },
sajuArticle2Text: { ko: "명리학의 핵심은 오행(목, 화, 토, 금, 수)의 상생과 상극에 있습니다.", en: "The core lies in the balance of the Five Elements." },
sajuArticle3Title: { ko: "대운과 세운의 흐름", en: "Life Cycles" },
sajuArticle3Text: { ko: "흐름을 미리 알면 용기 있게 나아갈 타이밍을 결정할 수 있습니다.", en: "Knowing the flow helps decide when to move forward." },

aboutMainTitle: { ko: "꿈타로 가이드", en: "DreamTarot Guide" },
aboutMainSubtitle: { ko: "당신의 운명을 이해하는 첫 번째 걸음", en: "First step to understanding destiny" },
aboutTitle1: { ko: "꿈타로 서비스 소개", en: "About Service" },
aboutCombinedText1: { ko: "꿈타로는 고전 타로 상징과 데이터 분석을 결합해 개인화된 리딩을 제공합니다.", en: "We combine tarot symbols with data for personalized readings." },
aboutCombinedText2: { ko: "사주 기운과 타로의 직관을 분석하여 현실적인 조언을 드립니다.", en: "We analyze Saju energy and Tarot intuition for practical advice." },

labelName: { ko: "이름", en: "Name" },
phName: { ko: "홍길동", en: "John Doe" },
labelBirth: { ko: "생년월일", en: "Birthdate" },
optSolar: { ko: "양력", en: "Solar" },
optLunar: { ko: "음력", en: "Lunar" },
labelGender: { ko: "성별", en: "Gender" },
genMale: { ko: "남성", en: "Male" },
genFemale: { ko: "여성", en: "Female" },
genNone: { ko: "선택안함", en: "None" },
labelMarital: { ko: "결혼 여부", en: "Marital Status" },
marSingle: { ko: "미혼", en: "Single" },
marMarried: { ko: "기혼", en: "Married" },
btnSubmitProfile: { ko: "운명의 수레바퀴 돌리기", en: "Turn the Wheel of Fate" },

selGreeting: { ko: "님, 환영합니다.", en: ", Welcome." },
selSubtitle: { ko: "어떤 운명의 속삭임을 듣고 싶으신가요?", en: "Which whisper of destiny to hear?" },
tarotLove: { ko: "궁합 타로", en: "Relationship Tarot" },
tarotLoveDesc: { ko: "당신과 그 사람을 잇는 인연의 끈을 확인해보세요.", en: "Check the threads of connection." },
tarotYear: { ko: "올해운 타로", en: "Yearly Tarot" },
tarotYearDesc: { ko: "올 한 해 당신의 삶에 펼쳐질 흐름을 읽어드립니다.", en: "Read the flow of your life this year." },
tarotCareer: { ko: "직업 타로", en: "Career Tarot" },
tarotCareerDesc: { ko: "당신의 재능이 빛날 길과 금전의 흐름을 조언해드립니다.", en: "Advice on talents and financial flows." },
tarotToday: { ko: "오늘운 타로", en: "Daily Tarot" },
tarotTodayDesc: { ko: "오늘 하루의 아침, 낮, 저녁 흐름을 살펴봅니다.", en: "Look at today's morning, day, and evening flow." },
btnSelect: { ko: "선택하기", en: "Select" },

partnerTitle: { ko: "인연의 끈을 찾아서", en: "Seeking Fate" },
partnerSubtitle: { ko: "궁합을 위해 상대방 정보를 입력해주세요.", en: "Enter partner's info for compatibility." },
labelPartnerName: { ko: "상대방 이름", en: "Partner's Name" },
phPartnerName: { ko: "성춘향", en: "Jane Doe" },
labelQuestion: { ko: "궁금한 점이나 고민 (선택사항)", en: "Question (Optional)" },
phPartnerQ: { ko: "예: 좋은 인연으로 발전할 수 있을까요?", en: "Ex: Will we develop well?" },
btnBack: { ko: "뒤로", en: "Back" },
btnSubmitLove: { ko: "궁합 확인하기", en: "Check Compatibility" },

careerTitle: { ko: "직업과 재물의 길을 묻다", en: "Career & Wealth" },
careerSubtitle: { ko: "분석을 위해 현재 고민을 적어주세요.", en: "Write down your current concerns." },
labelCareerQ: { ko: "직업/재물 관련 구체적인 질문 (선택사항)", en: "Specific Question (Optional)" },
phCareerQ: { ko: "예: 올해 이직운이 좋을까요?", en: "Ex: Any career moves this year?" },
btnSubmitCareer: { ko: "흐름 분석하기", en: "Analyze Flow" },

todayTitle: { ko: "오늘의 흐름을 묻다", en: "Today's Flow" },
todaySubtitle: { ko: "오늘 하루 집중하고 싶은 고민이 있으신가요?", en: "Anything to focus on today?" },
labelTodayQ: { ko: "오늘의 질문이나 다짐 (선택사항)", en: "Today's Question (Optional)" },
phTodayQ: { ko: "예: 오늘 미팅이 잘 풀릴까요?", en: "Ex: Will today's meeting go well?" },
btnSubmitToday: { ko: "오늘의 운세 보기", en: "View Fortune" },

shuffleTitle: { ko: "카드를 섞고 있습니다...", en: "Shuffling..." },
shuffleSubtitle: { ko: "잠시만 마음을 비우고 기다려주세요.", en: "Please wait a moment." },

drawTitle: { ko: "운명의 카드 선택", en: "Draw Cards" },
msgDrawInst: { ko: (c) => `마음을 집중하고 <strong>${c}장을 뽑아주세요.</strong>`, en: (c) => `Focus and draw <strong>${c} cards.</strong>` },
msgDrawProgress: { ko: (d, l) => `<strong>${d}장</strong> 뽑았습니다. <strong>${l}장</strong> 남았습니다.`, en: (d, l) => `<strong>${d}</strong> drawn. <strong>${l}</strong> left.` },
msgDrawDone: { ko: "카드가 모두 선택되었습니다.", en: "All cards selected." },
btnShowResult: { ko: "운명의 해석 듣기", en: "Listen to Fate" },

resTitle: { ko: "별의 궤적이 그리는 운명", en: "Destiny by Stars" },
resSubtitle: { ko: "선택한 카드가 전하는 다정한 메시지입니다.", en: "A warm message from your cards." },
resHeader: { ko: "상세 해석", en: "Detailed Analysis" },
btnRestart: { ko: "새로운 질문하기", en: "Ask New Question" },
btnLogout: { ko: "로그아웃", en: "Log Out" },

btnShare: { ko: "운명 공유하기", en: "Share Destiny" },
msgCopySuccess: { ko: "링크가 클립보드에 복사되었습니다.", en: "Link copied to clipboard." },
msgShareTitle: { ko: "별의 궤적이 그리는 나의 운명 - 꿈타로", en: "My destiny by the stars - DreamTarot" },
msgShareText: { ko: "당신의 운명도 확인해보세요.", en: "Check your destiny too." },

privacyTitle: { ko: "개인정보처리방침", en: "Privacy Policy" },
linkPrivacy: { ko: "개인정보처리방침", en: "Privacy Policy" },
linkTerms: { ko: "이용약관", en: "Terms" },
btnClose: { ko: "돌아가기", en: "Close" },
btnContact: { ko: "제휴 및 협업 문의", en: "Partnership Inquiry" },
errDate: { ko: "올바른 정보를 입력해주세요.", en: "Please enter valid info." },

// 추가된 누락 키
btnGoToAboutShort: { ko: "서비스 소개", en: "About Service" },
btnSubmitContact: { ko: "문의 보내기", en: "Send Inquiry" },
contactSubtitle: { ko: "꿈타로와 함께할 비즈니스 파트너를 기다립니다.", en: "Waiting for business partners to join DreamTarot." },
contactTitle: { ko: "함께 꿈을 그리다", en: "Dreaming Together" },
labelContactEmail: { ko: "회신 이메일", en: "Reply Email" },
labelContactMessage: { ko: "상세 내용", en: "Detailed Content" },
labelContactName: { ko: "업체명/성함", en: "Company/Name" },
labelContactSubject: { ko: "문의 제목", en: "Inquiry Subject" },
privacyContent: { 
    ko: `<p>꿈타로(이하 '회사')는 이용자의 개인정보를 중요시하며, '개인정보 보호법' 등 관련 법령을 준수합니다.</p>
<h4 class="text-amber-200 font-bold mt-4">1. 수집하는 개인정보 항목</h4>
<p>- 필수항목: 이메일, 이름, 생년월일, 성별, 결혼 여부<br/>- 수집방법: 서비스 이용 단계에서의 직접 입력</p>
<h4 class="text-amber-200 font-bold mt-4">2. 개인정보의 수집 및 이용목적</h4>
<p>- 타로 리딩 및 운세 서비스 결과 제공<br/>- 회원 관리 및 본인 확인<br/>- 서비스 개선 및 통계 분석</p>
<h4 class="text-amber-200 font-bold mt-4">3. 개인정보의 보유 및 이용기간</h4>
<p>이용자의 개인정보는 원칙적으로 회원 탈퇴 시까지 보유하며, 법령에서 정한 기간 동안 안전하게 보관 후 파기합니다.</p>
<h4 class="text-amber-200 font-bold mt-4">4. 개인정보의 파기절차 및 방법</h4>
<p>전자적 파일 형태의 정보는 기록을 재생할 수 없는 기술적 방법을 사용하여 삭제합니다.</p>`,
    en: `<p>DreamTarot (hereinafter 'the Company') values users' personal information and complies with relevant laws such as the 'Personal Information Protection Act'.</p>
<h4 class="text-amber-200 font-bold mt-4">1. Collected Personal Information Items</h4>
<p>- Required: Email, Name, Date of Birth, Gender, Marital Status<br/>- Collection Method: Direct input during service use</p>
<h4 class="text-amber-200 font-bold mt-4">2. Purpose of Collection and Use</h4>
<p>- Providing tarot readings and fortune-telling results<br/>- Member management and identity verification<br/>- Service improvement and statistical analysis</p>
<h4 class="text-amber-200 font-bold mt-4">3. Retention and Use Period</h4>
<p>In principle, personal information is retained until membership withdrawal and is safely stored and destroyed for the period specified by law.</p>
<h4 class="text-amber-200 font-bold mt-4">4. Destruction Procedures and Methods</h4>
<p>Electronic file information is deleted using technical methods that prevent record reproduction.</p>`
},
termsContent: {
    ko: `<h4 class="text-amber-200 font-bold">제 1 조 (목적)</h4>
<p>본 약관은 꿈타로가 제공하는 운세 서비스의 이용 조건 및 절차에 관한 사항을 규정함을 목적으로 합니다.</p>
<h4 class="text-amber-200 font-bold mt-4">제 2 조 (서비스의 성격)</h4>
<p>본 서비스가 제공하는 타로 리딩 결과는 오락 및 참고용이며, 이용자의 중대한 결정에 대한 법적 책임을 지지 않습니다.</p>
<h4 class="text-amber-200 font-bold mt-4">제 3 조 (이용자의 의무)</h4>
<p>이용자는 본인의 정보를 정확히 입력해야 하며, 타인의 정보를 도용하여 발생하는 문제에 대한 책임은 이용자에게 있습니다.</p>`,
    en: `<h4 class="text-amber-200 font-bold">Article 1 (Purpose)</h4>
<p>These terms aim to regulate the conditions and procedures for using the fortune-telling service provided by DreamTarot.</p>
<h4 class="text-amber-200 font-bold mt-4">Article 2 (Nature of Service)</h4>
<p>Tarot reading results provided by this service are for entertainment and reference only, and we are not legally responsible for users' major decisions.</p>
<h4 class="text-amber-200 font-bold mt-4">Article 3 (User Obligations)</h4>
<p>Users must enter their information accurately, and the user is responsible for problems caused by stealing others' information.</p>`
},
termsTitle: { ko: "이용약관", en: "Terms of Use" }
};

// 1. 상태(State) 변수 관리
let currentLang = 'en'; 
// 기본 언어 영어 설정
let userInfo = { name: '', birthDate: '', calendarType: 'solar', gender: 'none', maritalStatus: 'single' };
let partnerInfo = { name: '', birthDate: '', calendarType: 'solar', gender: 'none', question: '' };
let careerInfo = { question: '' };
let todayInfo = { question: '' };
let drawnCardsCount = 0;
let maxDrawCount = 5; 
let drawnCardsData = [];
let selectedTarotType = ''; 
let lastAIResult = null; 

// 가상의 타로 카드 데이터베이스 (78장 다국어 맵핑)
const tarotDatabase = [
// --- Major Arcana ---
{ id: 0, name: { ko: '바보 (The Fool)', en: 'The Fool' }, icon: 'footprints', baseCore: { ko: '새로운 시작과 순수함, 얽매이지 않는 자유로움', en: 'New beginnings, purity, and untethered freedom' } },
{ id: 1, name: { ko: '마법사 (The Magician)', en: 'The Magician' }, icon: 'wand-2', baseCore: { ko: '무한한 잠재력과 창조력, 의지를 현실로 만드는 힘', en: 'Infinite potential, creativity, and the power to manifest will' } },
{ id: 2, name: { ko: '여사제 (The High Priestess)', en: 'The High Priestess' }, icon: 'moon', baseCore: { ko: '깊은 통찰력과 직관, 내면의 지혜와 기다림', en: 'Deep insight, intuition, inner wisdom, and patience' } },
{ id: 3, name: { ko: '여황제 (The Empress)', en: 'The Empress' }, icon: 'flower', baseCore: { ko: '풍요로움과 모성, 사랑과 따뜻한 결실', en: 'Abundance, maternity, love, and warm fruition' } },
{ id: 4, name: { ko: '황제 (The Emperor)', en: 'The Emperor' }, icon: 'crown', baseCore: { ko: '확고한 기반과 안정, 책임감과 구조적인 통제력', en: 'Solid foundation, stability, responsibility, and structural control' } },
{ id: 5, name: { ko: '교황 (The Hierophant)', en: 'The Hierophant' }, icon: 'book-open', baseCore: { ko: '정신적인 가르침과 전통, 귀인의 도움과 믿음', en: 'Spiritual guidance, tradition, noble assistance, and faith' } },
{ id: 6, name: { ko: '연인 (The Lovers)', en: 'The Lovers' }, icon: 'heart-handshake', baseCore: { ko: '조화로운 결합과 깊은 유대감, 인생의 중요한 선택', en: 'Harmonious union, deep bonds, and important life choices' } },
{ id: 7, name: { ko: '전차 (The Chariot)', en: 'The Chariot' }, icon: 'swords', baseCore: { ko: '장애물을 뚫고 나아가는 강한 의지와 쟁취, 긍정적인 이동', en: 'Strong will to overcome obstacles, achievement, and positive movement' } },
{ id: 8, name: { ko: '힘 (Strength)', en: 'Strength' }, icon: 'flame', baseCore: { ko: '부드러운 내면의 강인함과 인내, 사랑으로 갈등을 포용하는 힘', en: 'Gentle inner strength, patience, and embracing conflict with love' } },
{ id: 9, name: { ko: '은둔자 (The Hermit)', en: 'The Hermit' }, icon: 'lantern', baseCore: { ko: '깊은 자기 성찰과 고독, 진리를 탐구하는 내면의 여정', en: 'Deep self-reflection, solitude, and the inner journey for truth' } },
{ id: 10, name: { ko: '운명의 수레바퀴', en: 'Wheel of Fortune' }, icon: 'dribbble', baseCore: { ko: '피할 수 없는 삶의 거대한 전환점과 새로운 주기의 시작', en: 'Inevitable turning points in life and the start of a new cycle' } },
{ id: 11, name: { ko: '정의 (Justice)', en: 'Justice' }, icon: 'scale', baseCore: { ko: '감정에 치우치지 않는 냉철한 균형과 공정한 결정', en: 'Cold balance without emotional bias and fair decisions' } },
{ id: 12, name: { ko: '매달린 사람 (The Hanged Man)', en: 'The Hanged Man' }, icon: 'anchor', baseCore: { ko: '자발적인 희생과 헌신, 관점의 전환과 새로운 깨달음', en: 'Voluntary sacrifice, devotion, shift in perspective, and new realization' } },
{ id: 13, name: { ko: '죽음 (Death)', en: 'Death' }, icon: 'skull', baseCore: { ko: '하나의 주기가 끝나는 완전한 종결, 그리고 새로운 부활', en: 'Complete termination of a cycle, followed by a new resurrection' } },
{ id: 14, name: { ko: '절제 (Temperance)', en: 'Temperance' }, icon: 'infinity', baseCore: { ko: '서로 다른 요소들의 조화로운 융합, 인내와 적절한 타협', en: 'Harmonious fusion of different elements, patience, and proper compromise' } },
{ id: 15, name: { ko: '악마 (The Devil)', en: 'The Devil' }, icon: 'flame-kindling', baseCore: { ko: '끊어내기 힘든 유혹과 집착, 물질적인 쾌락과 내면의 그림자', en: 'Hard-to-break temptations, obsession, material pleasure, and inner shadows' } },
{ id: 16, name: { ko: '탑 (The Tower)', en: 'The Tower' }, icon: 'building-2', baseCore: { ko: '예기치 않은 갑작스러운 붕괴, 오래된 허울을 깨고 나오는 충격적 변화', en: 'Unexpected sudden collapse, shocking change breaking old illusions' } },
{ id: 17, name: { ko: '별 (The Star)', en: 'The Star' }, icon: 'sparkles', baseCore: { ko: '고난 이후에 찾아오는 평온한 치유와 반짝이는 희망', en: 'Peaceful healing and twinkling hope that comes after hardship' } },
{ id: 18, name: { ko: '달 (The Moon)', en: 'The Moon' }, icon: 'moon-star', baseCore: { ko: '모호함 속에 숨겨진 불안과 환상, 무의식의 수면 아래에서 일어나는 변화', en: 'Anxiety hidden in ambiguity, illusions, and subconscious changes' } },
{ id: 19, name: { ko: '태양 (The Sun)', en: 'The Sun' }, icon: 'sun', baseCore: { ko: '어둠을 걷어내는 밝은 긍정과 활력, 명확한 성공', en: 'Bright positivity and vitality clearing darkness, and clear success' } },
{ id: 20, name: { ko: '심판 (Judgement)', en: 'Judgement' }, icon: 'bell-ring', baseCore: { ko: '과거의 업보에 대한 보상과 구원, 거듭남을 알리는 내면의 부름', en: 'Reward and salvation for past karma, an inner call for rebirth' } },
{ id: 21, name: { ko: '세계 (The World)', en: 'The World' }, icon: 'globe', baseCore: { ko: '하나의 완벽한 챕터의 완성, 그리고 더 높은 차원으로의 도약', en: 'Completion of a perfect chapter and a leap to a higher dimension' } },

// --- Minor Arcana : Wands ---
{ id: 22, name: { ko: '지팡이 에이스', en: 'Ace of Wands' }, icon: 'flame', baseCore: { ko: '순수한 열정의 점화, 주도적으로 무언가를 시작할 수 있는 에너지', en: 'Ignition of pure passion, energy to proactively start something' } },
{ id: 23, name: { ko: '지팡이 2', en: 'Two of Wands' }, icon: 'flame', baseCore: { ko: '현재에 안주하지 않고 더 먼 미래를 바라보는 계획과 확장', en: 'Planning and expanding towards a farther future beyond the present' } },
{ id: 24, name: { ko: '지팡이 3', en: 'Three of Wands' }, icon: 'flame', baseCore: { ko: '기반을 다지고 새로운 무대를 향해 나아가는 긍정적 기다림', en: 'Positive waiting as you build a foundation and step onto a new stage' } },
{ id: 25, name: { ko: '지팡이 4', en: 'Four of Wands' }, icon: 'flame', baseCore: { ko: '목표 달성 후의 평온한 휴식과 축하, 안정된 유대감', en: 'Peaceful rest, celebration, and stable bonds after achieving a goal' } },
{ id: 26, name: { ko: '지팡이 5', en: 'Five of Wands' }, icon: 'flame', baseCore: { ko: '서로의 주장이 엇갈리는 치열한 경쟁과 건강한 의견 충돌', en: 'Fierce competition and healthy clashes of differing opinions' } },
{ id: 27, name: { ko: '지팡이 6', en: 'Six of Wands' }, icon: 'flame', baseCore: { ko: '노력의 결과를 타인에게 인정받는 명예로운 승리와 환호', en: 'Honorable victory and cheers, recognized by others for your efforts' } },
{ id: 28, name: { ko: '지팡이 7', en: 'Seven of Wands' }, icon: 'flame', baseCore: { ko: '유리한 고지에서 자신의 신념과 자리를 굳건히 지켜내는 용기', en: 'Courage to firmly defend your beliefs and position from an advantage' } },
{ id: 29, name: { ko: '지팡이 8', en: 'Eight of Wands' }, icon: 'flame', baseCore: { ko: '상황이 지체 없이 매우 빠르고 급격하게 전개되는 흐름', en: 'A flow where situations develop very quickly and rapidly without delay' } },
{ id: 30, name: { ko: '지팡이 9', en: 'Nine of Wands' }, icon: 'flame', baseCore: { ko: '상처 입었지만 끝까지 포기하지 않고 버텨내는 끈기와 경계', en: 'Perseverance and vigilance to endure without giving up despite being hurt' } },
{ id: 31, name: { ko: '지팡이 10', en: 'Ten of Wands' }, icon: 'flame', baseCore: { ko: '목표에 닿기 직전 짊어지게 된 과도한 책임감과 압박', en: 'Excessive responsibility and pressure borne right before reaching the goal' } },
{ id: 32, name: { ko: '지팡이 시종', en: 'Page of Wands' }, icon: 'flame', baseCore: { ko: '새로운 소식을 전하거나 호기심 가득한 에너지로 시작하는 단계', en: 'A phase of delivering news or starting with curiosity-filled energy' } },
{ id: 33, name: { ko: '지팡이 기사', en: 'Knight of Wands' }, icon: 'flame', baseCore: { ko: '목표를 향해 거침없이 돌진하는 폭발적인 추진력과 모험심', en: 'Explosive drive and adventurous spirit charging towards the goal' } },
{ id: 34, name: { ko: '지팡이 여왕', en: 'Queen of Wands' }, icon: 'flame', baseCore: { ko: '밝은 에너지로 주변을 이끌어가는 따뜻하고 긍정적인 카리스마', en: 'Warm and positive charisma leading others with bright energy' } },
{ id: 35, name: { ko: '지팡이 왕', en: 'King of Wands' }, icon: 'flame', baseCore: { ko: '비전을 현실로 만들어내는 결단력과 강력한 통솔력', en: 'Decisiveness and strong leadership to turn visions into reality' } },

// --- Minor Arcana : Cups ---
{ id: 36, name: { ko: '컵 에이스', en: 'Ace of Cups' }, icon: 'droplets', baseCore: { ko: '마음속에서 흘러넘치는 깊은 감정의 시작, 새로운 사랑이나 영감', en: 'The start of deep overflowing emotions, new love, or inspiration' } },
{ id: 37, name: { ko: '컵 2', en: 'Two of Cups' }, icon: 'droplets', baseCore: { ko: '서로의 마음이 온전히 통하는 조화로운 결합과 교감', en: 'Harmonious union and communion where hearts fully connect' } },
{ id: 38, name: { ko: '컵 3', en: 'Three of Cups' }, icon: 'droplets', baseCore: { ko: '사람들과 감정을 나누며 즐기는 기쁨과 화기애애한 우정', en: 'Joy and amicable friendship enjoyed by sharing feelings with others' } },
{ id: 39, name: { ko: '컵 4', en: 'Four of Cups' }, icon: 'droplets', baseCore: { ko: '현실의 안정 속에서 찾아온 권태, 새로운 기회를 돌아볼 시간', en: 'Boredom found in realistic stability, time to reflect on new opportunities' } },
{ id: 40, name: { ko: '컵 5', en: 'Five of Cups' }, icon: 'droplets', baseCore: { ko: '상실에 대한 깊은 슬픔과 미련, 그러나 아직 남아있는 희망', en: 'Deep sorrow and lingering regret over loss, yet remaining hope' } },
{ id: 41, name: { ko: '컵 6', en: 'Six of Cups' }, icon: 'droplets', baseCore: { ko: '과거의 순수했던 추억에 대한 향수와 조건 없는 따뜻한 도움', en: 'Nostalgia for pure past memories and unconditional warm help' } },
{ id: 42, name: { ko: '컵 7', en: 'Seven of Cups' }, icon: 'droplets', baseCore: { ko: '수많은 선택지 앞에서 길을 잃은 환상, 현실적인 판단의 필요', en: 'Illusions of getting lost among many choices, a need for realistic judgment' } },
{ id: 43, name: { ko: '컵 8', en: 'Eight of Cups' }, icon: 'droplets', baseCore: { ko: '익숙한 것을 뒤로하고 더 깊은 의미를 찾아 떠나는 성숙한 여정', en: 'A mature journey leaving the familiar behind to seek deeper meaning' } },
{ id: 44, name: { ko: '컵 9', en: 'Nine of Cups' }, icon: 'droplets', baseCore: { ko: '간절히 바라던 소원이 이루어지고 만끽하는 내면의 충만한 만족', en: 'Inner fulfilling satisfaction as a desperately desired wish comes true' } },
{ id: 45, name: { ko: '컵 10', en: 'Ten of Cups' }, icon: 'droplets', baseCore: { ko: '사랑하는 이들과 함께 누리는 완벽한 조화와 무지개빛 행복', en: 'Perfect harmony and rainbow-like happiness enjoyed with loved ones' } },
{ id: 46, name: { ko: '컵 시종', en: 'Page of Cups' }, icon: 'droplets', baseCore: { ko: '예술적 영감과 풍부한 감수성으로 세상을 바라보는 순수한 마음', en: 'A pure heart viewing the world with artistic inspiration and rich sensitivity' } },
{ id: 47, name: { ko: '컵 기사', en: 'Knight of Cups' }, icon: 'droplets', baseCore: { ko: '마음을 담은 로맨틱한 제안과 부드러운 평화주의적 접근', en: 'A heartfelt romantic proposal and a gentle, pacifist approach' } },
{ id: 48, name: { ko: '컵 여왕', en: 'Queen of Cups' }, icon: 'droplets', baseCore: { ko: '바다처럼 깊은 공감 능력으로 타인을 치유하고 안아주는 포용력', en: 'Tolerance to heal and embrace others with an ocean-deep empathy' } },
{ id: 49, name: { ko: '컵 왕', en: 'King of Cups' }, icon: 'droplets', baseCore: { ko: '파도를 통제하듯 감정에 휩쓸리지 않고 성숙하게 조절하는 힘', en: 'The power to maturely regulate emotions without being swept away' } },

// --- Minor Arcana : Swords ---
{ id: 50, name: { ko: '검 에이스', en: 'Ace of Swords' }, icon: 'sword', baseCore: { ko: '혼란을 베어내는 명확하고 객관적인 통찰력과 단호한 결단', en: 'Clear, objective insight and resolute decision cutting through chaos' } },
{ id: 51, name: { ko: '검 2', en: 'Two of Swords' }, icon: 'sword', baseCore: { ko: '두 가지 선택지 사이에서 눈을 가린 채 유지하는 팽팽한 내적 갈등', en: 'Tense inner conflict maintained blindfolded between two choices' } },
{ id: 52, name: { ko: '검 3', en: 'Three of Swords' }, icon: 'sword', baseCore: { ko: '심장을 찌르는 듯한 깊은 슬픔과 상처, 피할 수 없는 아픔', en: 'Heart-piercing deep sorrow and wounds, unavoidable pain' } },
{ id: 53, name: { ko: '검 4', en: 'Four of Swords' }, icon: 'sword', baseCore: { ko: '치열한 생각에서 잠시 벗어나 회복과 안정을 취해야 할 휴식기', en: 'A resting period to step away from fierce thoughts and seek recovery' } },
{ id: 54, name: { ko: '검 5', en: 'Five of Swords' }, icon: 'sword', baseCore: { ko: '이기고도 잃는 것이 많은 씁쓸한 승리와 관계의 훼손', en: 'A bitter victory where much is lost despite winning, and damaged relationships' } },
{ id: 55, name: { ko: '검 6', en: 'Six of Swords' }, icon: 'sword', baseCore: { ko: '상처를 안고 잔잔한 물가를 향해 나아가는 점진적인 치유와 이동', en: 'Gradual healing and movement carrying wounds towards calm waters' } },
{ id: 56, name: { ko: '검 7', en: 'Seven of Swords' }, icon: 'sword', baseCore: { ko: '정면 돌파보다는 상황을 교묘하게 회피하거나 이탈하려는 심리', en: 'A mindset to cleverly avoid or escape situations rather than head-on' } },
{ id: 57, name: { ko: '검 8', en: 'Eight of Swords' }, icon: 'sword', baseCore: { ko: '스스로 만든 두려움에 갇혀 이러지도 저러지도 못하는 고립감', en: 'Isolation trapped in self-made fears, unable to move' } },
{ id: 58, name: { ko: '검 9', en: 'Nine of Swords' }, icon: 'sword', baseCore: { ko: '밤잠을 설치게 만드는 과도한 불안과 절망, 생각의 악순환', en: 'Excessive anxiety and despair causing sleepless nights, a vicious cycle of thoughts' } },
{ id: 59, name: { ko: '검 10', en: 'Ten of Swords' }, icon: 'sword', baseCore: { ko: '가장 깊은 바닥에 닿은 고통스러운 끝남, 역설적으로 다가오는 새로운 시작', en: 'Painful ending hitting rock bottom, paradoxically bringing a new beginning' } },
{ id: 60, name: { ko: '검 시종', en: 'Page of Swords' }, icon: 'sword', baseCore: { ko: '예리한 관찰력과 경계심, 날카로운 지적 호기심', en: 'Sharp observation and vigilance, keen intellectual curiosity' } },
{ id: 61, name: { ko: '검 기사', en: 'Knight of Swords' }, icon: 'sword', baseCore: { ko: '머뭇거림 없이 목표를 향해 달려가는 차갑고 논리적인 돌파력', en: 'Cold, logical breakthrough power rushing towards a goal without hesitation' } },
{ id: 62, name: { ko: '검 여왕', en: 'Queen of Swords' }, icon: 'sword', baseCore: { ko: '사사로운 감정을 배제하고 진실만을 꿰뚫어보는 냉철한 객관성', en: 'Cold objectivity piercing through truth by excluding personal feelings' } },
{ id: 63, name: { ko: '검 왕', en: 'King of Swords' }, icon: 'sword', baseCore: { ko: '확고한 권위와 이성적인 판단으로 혼란을 통제하는 지성', en: 'Intellect controlling chaos with firm authority and rational judgment' } },

// --- Minor Arcana : Pentacles ---
{ id: 64, name: { ko: '펜타클 에이스', en: 'Ace of Pentacles' }, icon: 'coins', baseCore: { ko: '물질적이고 현실적인 성과를 가져다줄 아주 든든하고 새로운 기회', en: 'A very solid and new opportunity bringing material and realistic results' } },
{ id: 65, name: { ko: '펜타클 2', en: 'Two of Pentacles' }, icon: 'coins', baseCore: { ko: '끊임없이 변하는 현실 속에서 유연하게 대처하며 균형을 잡는 기술', en: 'The skill of flexibly coping and balancing in a constantly changing reality' } },
{ id: 66, name: { ko: '펜타클 3', en: 'Three of Pentacles' }, icon: 'coins', baseCore: { ko: '서로 다른 전문성을 가진 이들과의 성공적인 협력과 조화', en: 'Successful cooperation and harmony with those holding different expertise' } },
{ id: 67, name: { ko: '펜타클 4', en: 'Four of Pentacles' }, icon: 'coins', baseCore: { ko: '가진 것을 잃지 않으려는 강한 집착과 보수적인 방어 태세', en: 'Strong obsession and conservative defensive stance to not lose what one has' } },
{ id: 68, name: { ko: '펜타클 5', en: 'Five of Pentacles' }, icon: 'coins', baseCore: { ko: '물질적, 혹은 정신적 결핍으로 인해 누군가의 도움이 절실한 시기', en: 'A time when someone\'s help is desperately needed due to material or mental deficiency' } },
{ id: 69, name: { ko: '펜타클 6', en: 'Six of Pentacles' }, icon: 'coins', baseCore: { ko: '관대함과 인색함 사이에서 이루어지는 베풂과 적절한 보상', en: 'Giving and appropriate rewards made between generosity and stinginess' } },
{ id: 70, name: { ko: '펜타클 7', en: 'Seven of Pentacles' }, icon: 'coins', baseCore: { ko: '지금까지 가꿔온 결실을 바라보며 향후의 방향을 평가하는 시간', en: 'Time to evaluate future directions while looking at the fruits cultivated so far' } },
{ id: 71, name: { ko: '펜타클 8', en: 'Eight of Pentacles' }, icon: 'coins', baseCore: { ko: '묵묵하고 성실하게 자신만의 기술과 역량을 갈고닦는 장인정신', en: 'Craftsmanship of silently and diligently honing one\'s own skills and capabilities' } },
{ id: 72, name: { ko: '펜타클 9', en: 'Nine of Pentacles' }, icon: 'coins', baseCore: { ko: '스스로의 노력으로 이룩해낸 안전하고 우아한 나만의 풍요', en: 'Safe and elegant personal abundance achieved through one\'s own efforts' } },
{ id: 73, name: { ko: '펜타클 10', en: 'Ten of Pentacles' }, icon: 'coins', baseCore: { ko: '대대로 이어지는 물질적 유산과 견고하게 완성된 가족의 부', en: 'Material legacy passed down generations and solidly completed family wealth' } },
{ id: 74, name: { ko: '펜타클 시종', en: 'Page of Pentacles' }, icon: 'coins', baseCore: { ko: '신중하게 현실을 파악하고 차근차근 배우며 나아가는 성실함', en: 'Diligence in carefully grasping reality and learning step-by-step' } },
{ id: 75, name: { ko: '펜타클 기사', en: 'Knight of Pentacles' }, icon: 'coins', baseCore: { ko: '느리지만 멈추지 않고 끝까지 책임을 다하는 우직함', en: 'Steadfastness in slowly but unstoppingly fulfilling responsibilities to the end' } },
{ id: 76, name: { ko: '펜타클 여왕', en: 'Queen of Pentacles' }, icon: 'coins', baseCore: { ko: '풍요로운 대지처럼 타인을 보살피고 아낌없이 내어주는 관대함', en: 'Generosity to care for others and give selflessly like the abundant earth' } },
{ id: 77, name: { ko: '펜타클 왕', en: 'King of Pentacles' }, icon: 'coins', baseCore: { ko: '확고한 재력과 성취를 이뤄내고 그것을 여유롭게 누리는 권위', en: 'Authority in achieving firm financial power and success, and enjoying it leisurely' } }
];

// 2. 초기화 및 언어 설정
document.addEventListener('DOMContentLoaded', async () => {
lucide.createIcons();
createStars();
const savedLang = localStorage.getItem('mungTarotLang');
if (savedLang) {
setLanguage(savedLang);
} else {
applyLanguage(); // Apply default (en)
}
loadSavedData();

if (userInfo && userInfo.name) {
showScreen('selection-screen');
} else {
showScreen('profile-screen');
}
});

// [추가] 언어 전환 로직
function setLanguage(lang) {
currentLang = lang;
localStorage.setItem('mungTarotLang', lang);

document.getElementById('lang-ko').classList.remove('active');
document.getElementById('lang-en').classList.remove('active');
document.getElementById(`lang-${lang}`).classList.add('active');

applyLanguage();
}

// [추가] 텍스트 동적 렌더링
function applyLanguage() {
document.querySelectorAll('[data-i18n]').forEach(el => {
const key = el.getAttribute('data-i18n');
if (uiTranslations[key] && uiTranslations[key][currentLang]) {
if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
el.placeholder = uiTranslations[key][currentLang];
} else {
el.innerHTML = uiTranslations[key][currentLang];
}
}
});

if(!document.getElementById('selection-screen').classList.contains('hidden') && userInfo.name) {
document.getElementById('display-name').textContent = userInfo.name;
}

// 결과 화면이 열려있는 경우 언어만 번역 업데이트 (AI 재호출 방지)
if(!document.getElementById('result-screen').classList.contains('hidden') && drawnCardsData.length > 0) {
const starContainer = document.getElementById('star-cards-container');
if (starContainer && starContainer.children.length > 0) {
Array.from(starContainer.children).forEach((cardEl, index) => {
const cardNameSpan = cardEl.querySelector('.card-front span');
if (cardNameSpan && drawnCardsData[index]) {
cardNameSpan.textContent = drawnCardsData[index].name[currentLang];
}
});
}
renderInterpretation();
}

// 카드 뽑기 지시문 동기화
const instruction = document.getElementById('draw-instruction');
if (instruction && instruction.innerHTML !== '') {
if (drawnCardsCount === 0) {
instruction.innerHTML = uiTranslations.msgDrawInst[currentLang](maxDrawCount);
} else if (drawnCardsCount < maxDrawCount) {
instruction.innerHTML = uiTranslations.msgDrawProgress[currentLang](drawnCardsCount, maxDrawCount - drawnCardsCount);
} else {
instruction.innerHTML = uiTranslations.msgDrawDone[currentLang];
}
}
}

// [추가] 해석 텍스트 렌더링 함수
function renderInterpretation() {
const interpretationContent = document.getElementById('interpretation-content');
if (!interpretationContent) return;

// AI 로딩 중이거나 데이터가 없으면 중단
if (interpretationContent.querySelector('#ai-loading-indicator') || drawnCardsData.length === 0) return;

interpretationContent.innerHTML = '';

if (lastAIResult && lastAIResult.mainInterpretation) {
const formattedText = lastAIResult.mainInterpretation.replace(/\\n/g, '<br/>');
interpretationContent.innerHTML = `
<div class="bg-slate-800/50 p-6 md:p-10 rounded-xl border border-purple-500/20 fade-in shadow-inner leading-relaxed text-slate-200 whitespace-pre-line text-lg">
${formattedText}
</div>
`;
} else {
const spreadTitlesKO = maxDrawCount === 3 ? ["✦ 태초의 기운", "✦ 전개되는 흐름", "✦ 하늘의 계시"] : ["현재의 좌표", "당면한 과제", "지나온 궤적", "다가올 풍경", "운명의 조언"];
const spreadTitlesEN = maxDrawCount === 3 ? ["✦ Primeval Energy", "✦ Unfolding Flow", "✦ Celestial Revelation"] : ["Current Coordinates", "Current Challenge", "Past Trajectory", "Approaching Scenery", "Destiny's Advice"];
const activeTitles = currentLang === 'en' ? spreadTitlesEN : spreadTitlesKO;

drawnCardsData.forEach((card, index) => {
const textEl = document.createElement('div');
textEl.className = `bg-slate-800/50 p-6 rounded-xl border border-purple-500/20 fade-in shadow-inner mb-4`;
const deepInterpretationText = generateDeepInterpretation(card, index, userInfo, selectedTarotType, partnerInfo);
textEl.innerHTML = `
<h4 class="text-amber-300 font-bold mb-4 text-xl">
${activeTitles[index]}
</h4>
<p class="text-slate-200 leading-loose mb-4">
${deepInterpretationText}
</p>
<div class="flex justify-end border-t border-purple-500/10 pt-3">
<span class="bg-amber-500/20 text-amber-200 w-8 h-8 flex items-center justify-center rounded-full text-sm border border-amber-500/30">${index + 1}</span>
</div>
`;
interpretationContent.appendChild(textEl);
});
}
lucide.createIcons({ root: interpretationContent });
}

function loadSavedData() {
try {
const savedUser = localStorage.getItem('mungTarotUser');
if (savedUser) {
userInfo = JSON.parse(savedUser);
document.getElementById('name-input').value = userInfo.name || '';
if (userInfo.birthDate) {
const parts = userInfo.birthDate.split('-');
if (parts.length === 3) {
document.getElementById('year-input').value = parts[0];
document.getElementById('month-input').value = parts[1];
document.getElementById('day-input').value = parts[2];
}
}
document.getElementById('calendar-type-input').value = userInfo.calendarType || 'solar';

document.querySelectorAll('input[name="gender"]').forEach(radio => {
if (radio.value === userInfo.gender) radio.checked = true;
});
document.querySelectorAll('input[name="marital-status"]').forEach(radio => {
if (radio.value === userInfo.maritalStatus) radio.checked = true;
});
}

const savedPartner = localStorage.getItem('mungTarotPartner');
if (savedPartner) {
partnerInfo = JSON.parse(savedPartner);
document.getElementById('partner-name-input').value = partnerInfo.name || '';
if (partnerInfo.birthDate) {
const parts = partnerInfo.birthDate.split('-');
if (parts.length === 3) {
document.getElementById('partner-year-input').value = parts[0];
document.getElementById('partner-month-input').value = parts[1];
document.getElementById('partner-day-input').value = parts[2];
}
}
document.getElementById('partner-calendar-type-input').value = partnerInfo.calendarType || 'solar';

document.querySelectorAll('input[name="partner-gender"]').forEach(radio => {
if (radio.value === partnerInfo.gender) radio.checked = true;
});
}


} catch (error) {
console.error("데이터를 불러오는 중 오류가 발생했습니다.", error);
}
}

// AI 해석 엔진 (Cloudflare Pages Function 연동)
async function fetchAIInterpretation(cards, user, type, contextInfo) {
const destiny = calculateDestinyEnergy(user.birthDate);
const cardNames = cards.map(c => c.name[currentLang]).join(', ');
const question = contextInfo.question || (currentLang === 'ko' ? "전반적인 운세" : "overall fortune");

const prompt = currentLang === 'ko' ? `
       [시스템 페르소나] 당신은 개인의 고유한 성질과 현재의 시간적 흐름을 통합 분석하여 맞춤형 삶의 전략을 제시하는 '인생 전략가'입니다. 
       사용자가 선택한 타로 카드의 상징을 분석하되, 사용자의 본질적 특성(입력 데이터 참고)과 결합하여 '단순 예측'이 아닌 '즉각 실행 가능한 해결책'을 제시하십시오.

       [입력 정보]
       - 질문 상황: ${type} (${question})
       - 선택된 카드: ${cardNames}
       - 사용자 성함: ${user.name}
       - 본질적 특성 분석 데이터: ${destiny.energyFlavor.ko}, ${destiny.zodiac.ko} (중요: '별자리', '사주', '명리학', '기운' 등의 단어는 절대 직접 언급하지 마십시오. 그 특징만을 해석에 자연스럽게 녹여내어 '당신이 타고난 성향'이나 '현재 당신을 감싸는 흐름' 등으로 표현하십시오.)
       - 현재의 시기적 흐름: ${destiny.cycleFlow.ko}

       [답변 구성 지시]
       1. **본질의 공명 (도입)**: 사용자가 타고난 고유의 성향과 현재 고민이 어떻게 맞닿아 있는지 부드럽고 품격 있게 설명하십시오. 
       2. **운명의 전략 (본론)**: 선택된 타로 카드들이 현재 상황(${question})에 대해 주는 구체적인 메시지를 분석하십시오. 사용자가 가진 고유의 강점이 이 상황을 돌파할 어떻게 열쇠가 될지 전략적으로 서술하십시오.
       3. **즉각적 행동 지침 (결론)**: 오늘부터 바로 실천할 수 있는 '3단계 액션 플랜'을 제시하십시오.
          - 1단계: 마음가짐 혹은 우선적으로 피해야 할 태도
          - 2단계: 행운을 부르는 구체적인 행동 (예: 특정 색상의 소품, 장소 방문, 권장하는 대화법 등)
          - 3단계: 당신의 에너지가 가장 맑게 깨어나는 '골든 타임' 제안

       [규칙]
       - '별자리', '명리학', '사주', '기운' 등의 직접적인 용어는 절대 사용하지 마십시오.
       - 문장 사이사이에 줄바꿈을 자주 사용하여 모바일 가독성을 극대화하십시오.
       - **가장 중요한 통찰과 행동 지침은 반드시 <span class="text-amber-400 font-bold">...</span> 태그로 강조하십시오.**
   ` : `
       [System Persona] You are a 'Life Strategist' who provides practical solutions by analyzing a person's unique essence and the current temporal flow. 
       Analyze the symbols of the chosen Tarot cards, but combine them with the user's inherent nature to offer 'immediately actionable advice'.

       [Input Data]
       - Context: ${type} (${question})
       - Drawn Cards: ${cardNames}
       - User Name: ${user.name}
       - Inherent Nature Data: ${destiny.energyFlavor.en}, ${destiny.zodiac.en} (IMPORTANT: Never mention terms like 'Zodiac', 'Astrology', 'Saju', or 'Energy' directly. Integrate their characteristics naturally into the interpretation.)
       - Current Life Flow: ${destiny.cycleFlow.en}

       [Response Structure]
       1. **Resonance of Essence (Intro)**: Elegantly explain how the user's innate tendencies connect with their current concern.
       2. **Strategy of Destiny (Body)**: Analyze the specific messages of the Tarot cards regarding the situation (${question}). Strategically describe how the user's unique strengths can be the key to a breakthrough.
       3. **Immediate Action Plan (Conclusion)**: Provide a '3-step action plan' for immediate implementation.
          - Step 1: Mindset or attitude to prioritize/avoid.
          - Step 2: Specific lucky action (e.g., color of an item, place to visit, recommended communication style).
          - Step 3: Suggest a 'Golden Time' when their energy is most clear.

       [Response Rules]
       - NEVER use terms like 'Zodiac', 'Astrology', 'Saju', or 'Energy' directly.
       - Use frequent line breaks for maximum readability.
       - **Highlight critical insights and action steps with <span class="text-amber-400 font-bold">...</span> tags.**
       - Answer in English.
   `;

const payload = {
    contents: [{
        role: "user",
        parts: [{ text: prompt }]
    }],
    generationConfig: { 
        maxOutputTokens: 3000, 
        temperature: 0.7,
        topP: 0.95,
        topK: 40
    }
};

try {
const response = await fetch(`/api/gemini`, {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(payload)
});

const data = await response.json();

if (!response.ok) {
    if (response.status === 429) {
        console.warn("Gemini API 할당량 초과 (HTTP 429)");
        return { isQuotaExceeded: true };
    }
    console.error("Gemini API 상세 에러:", data);
    throw new Error(data.details?.message || data.error || 'API_ERROR');
}

// 표준 Gemini 응답 파싱 (candidates[0].content.parts[0].text)
const fullText = data.candidates?.[0]?.content?.parts?.[0]?.text || "";

const insightMatch = fullText.match(/\[INSIGHT\](.*)/);
const mainInterpretation = fullText.replace(/\[INSIGHT\].*/, '').trim();
const newInsights = insightMatch ? insightMatch[1].trim() : "";

return { mainInterpretation, newInsights };
} catch (error) {
console.warn("AI 리딩 실패, 로컬 엔진 전환:", error);
return null;
}
}



// 3. 커스텀 토스트 메시지 함수
function showMessage(msgObj, type = 'error') {
const msg = typeof msgObj === 'string' ? msgObj : msgObj[currentLang];
const container = document.getElementById('toast-container');
const toast = document.createElement('div');
const bgClass = type === 'error' ? 'bg-rose-900/80 border-rose-500/50 text-rose-100' : 'bg-slate-800 border-purple-500/50 text-amber-100';
toast.className = `toast-enter flex items-center p-4 rounded-lg shadow-lg border backdrop-blur-md pointer-events-auto ${bgClass}`;
toast.innerHTML = `<i data-lucide="${type === 'error' ? 'alert-circle' : 'info'}" class="w-5 h-5 mr-3"></i><span class="text-sm font-medium">${msg}</span>`;
container.appendChild(toast);
lucide.createIcons({ root: toast });
setTimeout(() => {
toast.classList.remove('toast-enter');
toast.classList.add('toast-leave');
setTimeout(() => toast.remove(), 300);
}, 3000);
}

// 4. 화면 전환 함수
function showScreen(screenId) {
// 모든 가능 화면 ID 목록 (누락 방지)
const screens = [
'profile-screen', 'selection-screen', 
'partner-profile-screen', 'career-profile-screen', 'today-profile-screen', 
'reading-screen', 'draw-screen', 'result-screen', 
'contact-screen', 'privacy-screen', 'terms-screen', 'about-dreamtarot-screen'
];

screens.forEach(id => {
const el = document.getElementById(id);
if (el) {
el.classList.add('hidden');
el.classList.remove('flex');
}
});

const targetScreen = document.getElementById(screenId);
if (targetScreen) {
targetScreen.classList.remove('hidden');
targetScreen.classList.add('flex');

// 특정 화면 진입 시 추가 처리
if (screenId === 'selection-screen') {
document.getElementById('display-name').textContent = userInfo.name || '여행자';
}
window.scrollTo(0, 0); // 화면 전환 시 최상단으로 이동
} else {
console.error("Target screen not found:", screenId);
}
}

// 6. 폼 제출 이벤트 로직

document.getElementById('profile-form').addEventListener('submit', async function(e) {
e.preventDefault();
const name = document.getElementById('name-input').value.trim();
const year = document.getElementById('year-input').value.trim();
const month = document.getElementById('month-input').value.trim();
const day = document.getElementById('day-input').value.trim();
const calendarType = document.getElementById('calendar-type-input').value;
const gender = document.querySelector('input[name="gender"]:checked').value;
const maritalStatus = document.querySelector('input[name="marital-status"]:checked').value;

const y = parseInt(year, 10);
const m = parseInt(month, 10);
const d = parseInt(day, 10);
const currentYear = new Date().getFullYear();

if (!name || isNaN(y) || y < 1900 || y > currentYear || isNaN(m) || m < 1 || m > 12 || isNaN(d) || d < 1 || d > 31) {
showMessage(uiTranslations.errDate);
return;
}

const birthDate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
userInfo = { name, birthDate, calendarType, gender, maritalStatus };

localStorage.setItem('mungTarotUser', JSON.stringify(userInfo));

// Supabase에 프로필 정보 저장 (화면 전환을 방해하지 않도록 독립적으로 실행)
const saveProfileToDB = async () => {
    if (window.supabaseClient) {
        try {
            const { data: { user } } = await window.supabaseClient.auth.getUser();
            if (user) {
                await window.supabaseClient.from('profiles').upsert({
                    id: user.id,
                    name,
                    birth_date: birthDate,
                    calendar_type: calendarType,
                    gender,
                    marital_status: maritalStatus,
                    updated_at: new Date()
                });
            }
        } catch (err) {
            console.warn("Background DB save failed:", err);
        }
    }
};
saveProfileToDB(); // await를 생략하여 즉시 다음 코드로 진행

// 즉시 다음 화면으로 전환
showScreen('selection-screen');
});

document.getElementById('partner-profile-form').addEventListener('submit', function(e) {
e.preventDefault();
const name = document.getElementById('partner-name-input').value.trim();
const year = document.getElementById('partner-year-input').value.trim();
const month = document.getElementById('partner-month-input').value.trim();
const day = document.getElementById('partner-day-input').value.trim();
const calendarType = document.getElementById('partner-calendar-type-input').value;
const gender = document.querySelector('input[name="partner-gender"]:checked').value;
const question = document.getElementById('partner-question-input').value.trim();

const y = parseInt(year, 10);
const m = parseInt(month, 10);
const d = parseInt(day, 10);
const currentYear = new Date().getFullYear();

if (!name || isNaN(y) || y < 1900 || y > currentYear || isNaN(m) || m < 1 || m > 12 || isNaN(d) || d < 1 || d > 31) {
showMessage(uiTranslations.errDate);
return;
}

const birthDate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
partnerInfo = { name, birthDate, calendarType, gender, question };

const partnerToSave = { ...partnerInfo, question: '' };
localStorage.setItem('mungTarotPartner', JSON.stringify(partnerToSave));

showScreen('reading-screen');
setTimeout(() => { initDrawScreen(); showScreen('draw-screen'); }, 3000);
});

document.getElementById('career-profile-form').addEventListener('submit', function(e) {
e.preventDefault();
const question = document.getElementById('career-question-input').value.trim();
careerInfo = { question };
showScreen('reading-screen');
setTimeout(() => { initDrawScreen(); showScreen('draw-screen'); }, 3000);
});

document.getElementById('today-profile-form').addEventListener('submit', function(e) {
e.preventDefault();
const question = document.getElementById('today-question-input').value.trim();
todayInfo = { question };
showScreen('reading-screen');
setTimeout(() => { initDrawScreen(); showScreen('draw-screen'); }, 3000);
});

// 7. 타로 선택 로직
function selectTarot(type) {
selectedTarotType = type;
maxDrawCount = (type === 'today') ? 3 : 5; 

if (type === 'love') {
showScreen('partner-profile-screen');
} else if (type === 'career') {
showScreen('career-profile-screen');
} else if (type === 'today') {
showScreen('today-profile-screen');
} else {
showScreen('reading-screen');
setTimeout(() => { initDrawScreen(); showScreen('draw-screen'); }, 3000);
}
}

// 8. 카드 뽑기 화면 초기화
function initDrawScreen() {
drawnCardsCount = 0;
drawnCardsData = []; 
const deckContainer = document.getElementById('card-deck-container');
const resultContainer = document.getElementById('result-action-container');
const instruction = document.getElementById('draw-instruction');
const slotsContainer = document.getElementById('slots-container');

deckContainer.innerHTML = '';
instruction.innerHTML = uiTranslations.msgDrawInst[currentLang](maxDrawCount);

resultContainer.classList.remove('opacity-100', 'pointer-events-auto');
resultContainer.classList.add('opacity-0', 'pointer-events-none');

slotsContainer.innerHTML = '';
for (let i = 1; i <= maxDrawCount; i++) {
slotsContainer.innerHTML += `
                  <div id="slot-${i}" class="w-14 h-20 md:w-20 md:h-32 rounded-lg border-2 border-dashed border-purple-500/50 flex flex-col items-center justify-center transition-all duration-500">
                      <span class="text-purple-500/50 text-xs md:text-sm font-bold">${i}</span>
                  </div>
              `;
}

const totalCards = 78;
for (let i = 0; i < totalCards; i++) {
const card = document.createElement('div');
card.className = 'tarot-card-item fade-in';
card.style.animationDelay = `${i * 0.015}s`; 
card.onclick = function() { drawCard(this); };
deckContainer.appendChild(card);
}
}

// 9. 카드 한 장 뽑기
function drawCard(cardElement) {
if (drawnCardsCount >= maxDrawCount) return; 
if (cardElement.classList.contains('drawn')) return; 

drawnCardsCount++;
cardElement.classList.add('drawn');

let availableCards = tarotDatabase.filter(card => !drawnCardsData.some(drawn => drawn.id === card.id));
let randomIdx = Math.floor(Math.random() * availableCards.length);
drawnCardsData.push(availableCards[randomIdx]);

const slot = document.getElementById(`slot-${drawnCardsCount}`);
slot.className = 'w-14 h-20 md:w-20 md:h-32 rounded-lg border border-amber-400 shadow-lg shadow-amber-900/50 transition-all duration-500 fade-in';
slot.style.backgroundImage = "url('card-back.png?v=2')";
slot.style.backgroundSize = "cover";
slot.style.backgroundPosition = "center";
slot.innerHTML = ''; 

const instruction = document.getElementById('draw-instruction');
if (drawnCardsCount < maxDrawCount) { 
instruction.innerHTML = uiTranslations.msgDrawProgress[currentLang](drawnCardsCount, maxDrawCount - drawnCardsCount);
} else {
instruction.innerHTML = uiTranslations.msgDrawDone[currentLang];
const resultContainer = document.getElementById('result-action-container');
resultContainer.classList.remove('opacity-0', 'pointer-events-none');
resultContainer.classList.add('opacity-100', 'pointer-events-auto');
}
}

// --- 사주/명리 기반 우주 에너지 계산 (다국어 호환 교정) ---
function calculateDestinyEnergy(birthDateStr) {
const dateParts = birthDateStr.split('-');
const birthYear = parseInt(dateParts[0], 10);
const birthMonth = parseInt(dateParts[1], 10);
const birthDay = parseInt(dateParts[2], 10);
const currentYear = new Date().getFullYear();
const age = currentYear - birthYear;

// 1. 명리학적 기운 (Eastern Saju)
let energyFlavor = {};
if (birthMonth >= 2 && birthMonth <= 4) {
energyFlavor = { ko: "목(木) - 성장의 기운", en: "Wood - Energy of Growth" };
} else if (birthMonth >= 5 && birthMonth <= 7) {
energyFlavor = { ko: "화(火) - 열정의 기운", en: "Fire - Energy of Passion" };
} else if (birthMonth >= 8 && birthMonth <= 10) {
energyFlavor = { ko: "금(金) - 결실의 기운", en: "Metal - Energy of Harvest" };
} else {
energyFlavor = { ko: "수(水) - 지혜의 기운", en: "Water - Energy of Wisdom" };
}

// 2. 서양 점성술 (Western Astrology)
let zodiac = {};
if ((birthMonth == 3 && birthDay >= 21) || (birthMonth == 4 && birthDay <= 19)) zodiac = { ko: "양자리 (Aries)", en: "Aries" };
else if ((birthMonth == 4 && birthDay >= 20) || (birthMonth == 5 && birthDay <= 20)) zodiac = { ko: "황소자리 (Taurus)", en: "Taurus" };
else if ((birthMonth == 5 && birthDay >= 21) || (birthMonth == 6 && birthDay <= 21)) zodiac = { ko: "쌍둥이자리 (Gemini)", en: "Gemini" };
else if ((birthMonth == 6 && birthDay >= 22) || (birthMonth == 7 && birthDay <= 22)) zodiac = { ko: "게자리 (Cancer)", en: "Cancer" };
else if ((birthMonth == 7 && birthDay >= 23) || (birthMonth == 8 && birthDay <= 22)) zodiac = { ko: "사자자리 (Leo)", en: "Leo" };
else if ((birthMonth == 8 && birthDay >= 23) || (birthMonth == 9 && birthDay <= 22)) zodiac = { ko: "처녀자리 (Virgo)", en: "Virgo" };
else if ((birthMonth == 9 && birthDay >= 23) || (birthMonth == 10 && birthDay <= 23)) zodiac = { ko: "천칭자리 (Libra)", en: "Libra" };
else if ((birthMonth == 10 && birthDay >= 24) || (birthMonth == 11 && birthDay <= 22)) zodiac = { ko: "전갈자리 (Scorpio)", en: "Scorpio" };
else if ((birthMonth == 11 && birthDay >= 23) || (birthMonth == 12 && birthDay <= 21)) zodiac = { ko: "사수자리 (Sagittarius)", en: "Sagittarius" };
else if ((birthMonth == 12 && birthDay >= 22) || (birthMonth == 1 && birthDay <= 19)) zodiac = { ko: "염소자리 (Capricorn)", en: "Capricorn" };
else if ((birthMonth == 1 && birthDay >= 20) || (birthMonth == 2 && birthDay <= 18)) zodiac = { ko: "물병자리 (Aquarius)", en: "Aquarius" };
else zodiac = { ko: "물고기자리 (Pisces)", en: "Pisces" };

const lifePhase = age % 10;
let cycleFlow = {};
if (lifePhase <= 2) {
cycleFlow = { ko: "전환의 시기", en: "Transition Period" };
} else if (lifePhase <= 6) {
cycleFlow = { ko: "확장의 시기", en: "Expansion Period" };
} else {
cycleFlow = { ko: "안정의 시기", en: "Stability Period" };
}

return { energyFlavor, zodiac, cycleFlow };
}

// --- 위치별 딥리딩 생성 함수 (다국어 처리) ---
function createStars() {
    const container = document.querySelector('.stars-container');
    if (!container) return;
    container.innerHTML = '';
    
    // 깊이감이 있는 별들 생성
    for (let i = 0; i < 150; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        
        // 3D 공간의 무작위 위치
        const x = Math.random() * 100;
        const y = Math.random() * 100;
        const z = (Math.random() * 800) - 400; // -400px to 400px depth
        
        // 크기와 투명도
        const size = Math.random() * 2 + 1;
        const maxOpacity = Math.random() * 0.5 + 0.5;
        const duration = Math.random() * 3 + 2;
        const delay = Math.random() * 5;
        
        star.style.left = `${x}%`;
        star.style.top = `${y}%`;
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.setProperty('--z-depth', `${z}px`);
        star.style.setProperty('--max-opacity', maxOpacity);
        star.style.setProperty('--duration', `${duration}s`);
        star.style.animationDelay = `${delay}s`;
        
        container.appendChild(star);
    }
    
    // 별똥별 생성
    setInterval(() => {
        const space = document.querySelector('.space-background');
        if (space && Math.random() > 0.5) { // 50% 확률로 생성
            const shootingStar = document.createElement('div');
            shootingStar.className = 'shooting-star';
            shootingStar.style.left = `${Math.random() * 100}%`;
            space.appendChild(shootingStar);
            
            setTimeout(() => {
                shootingStar.remove();
            }, 4000);
        }
    }, 2000);
}

function generateDeepInterpretation(card, index, userInfo, type, partnerInfo) {
const destiny = calculateDestinyEnergy(userInfo.birthDate);
const cName = card.name[currentLang];
const cCore = card.baseCore[currentLang];
const uName = userInfo.name;
const uEnergy = destiny.energyFlavor[currentLang];
const uZodiac = destiny.zodiac[currentLang];
const uCycle = destiny.cycleFlow[currentLang];

if (currentLang === 'en') {
    const energyContext = `As one who naturally embodies the essence of ${uEnergy} and the spirit of ${uZodiac}, `;
    if (type === 'today') {
        const dailyFlows = [
            `The morning sun reflects <strong>'${cName}'</strong>. It whispers that your dawn resonates with <strong>[${cCore}]</strong>. Walk softly, for the seeds of your day are being sown in this very vibration.`,
            `The mid-day zenith brings the shadow of <strong>'${cName}'</strong>. Amidst the busyness, the core of <strong>[${cCore}]</strong> will manifest as your guiding light. Observe the signs around you.`,
            `As the stars emerge, <strong>'${cName}'</strong> settles into your spirit. The resonance of <strong>[${cCore}]</strong> will be the final note of your day, offering peace and a chance for silent reflection.`
        ];
        return dailyFlows[index] || `The vibration of <strong>'${cName}'</strong> guides your path.`;
    }

    const cosmicReadings = [
        `<strong>The Foundation of Fate:</strong> ${energyContext} the appearance of <strong>'${cName}'</strong> signifies that <strong>[${cCore}]</strong> is the sacred soil upon which your current life is built.`,
        `<strong>The Trial of the Soul:</strong> Your immediate hurdle is mirrored in <strong>'${cName}'</strong>. Within your current phase of <em>${uCycle}</em>, you are being asked to master <strong>[${cCore}]</strong>.`,
        `<strong>The Echo of the Past:</strong> Behind the veil of the present lies <strong>'${cName}'</strong>. Your past experience with <strong>[${cCore}]</strong> is the invisible wind pushing your sail forward.`,
        `<strong>The Horizon of Tomorrow:</strong> The stars are weaving <strong>'${cName}'</strong> into your path. You shall soon witness the blossoming of <strong>[${cCore}]</strong> in your near future.`,
        `<strong>The Divine Guidance:</strong> Take the wisdom of <strong>'${cName}'</strong> as your ultimate compass. The universe encourages you to seek <strong>[${cCore}]</strong> for your growth.`
    ];
    return cosmicReadings[index] || `The card <strong>'${cName}'</strong> holds the key to <strong>[${cCore}]</strong>.`;

} else {
    // 국문: 고전적이고 문학적인 서사형 리딩
    const energyContext = `${uName}님이 지닌 ${uEnergy}의 본질과 ${uZodiac}의 기질이 어우러져, `;
    
    if (type === 'today') {
        const dailyFlows = [
            `새벽의 정적을 깨고 나타난 <strong>'${cName}'</strong> 카드는 오늘 당신의 시작이 <strong>[${cCore}]</strong>와 깊이 공명하고 있음을 암시합니다. 첫 발자국에 깃든 이 운율을 따라가 보십시오.`,
            `태양이 머리 위에 머무는 시간, <strong>'${cName}'</strong>의 형상이 더욱 선명해집니다. 삶의 번잡함 속에서도 <strong>[${cCore}]</strong>라는 핵심을 놓치지 않는다면 길을 잃지 않을 것입니다.`,
            `별빛이 내려앉는 저녁, <strong>'${cName}'</strong>의 에너지가 하루를 갈무리합니다. 오늘 얻은 <strong>[${cCore}]</strong>라는 배움은 당신의 내면을 살찌우는 소중한 자양분이 될 것입니다.`
        ];
        return dailyFlows[index] || `<strong>'${cName}'</strong>의 기운이 당신의 하루와 함께합니다.`;
    }

    const cosmicReadings = [
        `<strong>운명의 주춧돌</strong>: ${energyContext} 현재 당신이 딛고 선 자리에 <strong>'${cName}'</strong>이 나타나 <strong>[${cCore}]</strong>라는 강한 맥박이 흐르고 있음을 말해줍니다.`,
        `<strong>영혼의 시험대</strong>: 당신의 앞길을 마주한 과제는 <strong>'${cName}'</strong>의 모습입니다. 현재 <em>${uCycle}</em>의 흐름 속에서 <strong>[${cCore}]</strong>를 어떻게 다루느냐가 중요할 것입니다.`,
        `<strong>기억의 메아리</strong>: 현재의 당신을 만든 것은 과거의 <strong>'${cName}'</strong>이 남긴 흔적입니다. 지나온 시간 속의 <strong>[${cCore}]</strong>가 이제는 지혜라는 이름의 나침반이 되어주고 있습니다.`,
        `<strong>다가올 계시</strong>: 머지않아 당신의 삶에는 <strong>'${cName}'</strong>의 풍경이 펼쳐질 것입니다. <strong>[${cCore}]</strong>의 현상이 예기치 못한 순간에 당신의 일상을 찾아올 것을 예견합니다.`,
        `<strong>하늘의 전언</strong>: 마지막으로 별들이 전하는 조언에 귀를 기울이십시오. <strong>'${cName}'</strong> 카드는 당신이 나아갈 궁극의 방향이 <strong>[${cCore}]</strong>에 있음을 명시합니다.`
    ];
    return cosmicReadings[index] || `<strong>'${cName}'</strong> 카드가 당신의 삶에 <strong>[${cCore}]</strong>라는 화두를 던지고 있습니다.`;
}
}

// 10. 결과 및 해석 화면 렌더링 (AI + Fallback)
async function showResultScreen() {
    showScreen('result-screen');

    const starContainer = document.getElementById('star-cards-container');
    const interpretationContent = document.getElementById('interpretation-content');
    const svgContainer = document.getElementById('spread-svg-container');

    starContainer.innerHTML = '';
    interpretationContent.innerHTML = `
        <div id="ai-loading-indicator" class="flex flex-col items-center justify-center py-12 text-center">
            <div class="w-12 h-12 border-4 border-purple-500 border-t-amber-400 rounded-full animate-spin mb-4"></div>
            <p class="text-amber-200 animate-pulse">${currentLang === 'ko' ? '타로술사가 별의 속삭임을 읽는 중입니다...' : 'The tarot reader is listening to the whispers of the stars...'}</p>
        </div>
    `;

    // 스프레드 시각화
    if (maxDrawCount === 3) {
        svgContainer.innerHTML = `<svg class="absolute inset-0 w-full h-full opacity-30" viewBox="0 0 100 100"><line x1="20" y1="50" x2="80" y2="50" stroke="#fbbf24" stroke-width="0.5" stroke-dasharray="2,2" /></svg>`;
    } else {
        svgContainer.innerHTML = `<svg class="absolute inset-0 w-full h-full opacity-30" viewBox="0 0 100 100"><polygon points="50,15 85,40 70,85 30,85 15,40" fill="none" stroke="#fbbf24" stroke-width="0.5" /><polygon points="50,15 70,85 15,40 85,40 30,85" fill="none" stroke="#fbbf24" stroke-width="0.5" /></svg>`;
    }

    drawnCardsData.forEach((card, index) => {
        const cardEl = document.createElement('div');
        cardEl.className = `spread-card ${maxDrawCount === 3 ? 'pos-today-' : 'pos-'}${index + 1} fade-in-centered`;
        cardEl.style.animationDelay = `${index * 0.2}s`;
        cardEl.innerHTML = `<div class="card-front"><i data-lucide="${card.icon}" class="w-8 h-8 text-amber-600 mb-2"></i><span class="text-[0.65rem] font-bold">${card.name[currentLang]}</span></div>`;
        starContainer.appendChild(cardEl);
    });
    lucide.createIcons();

    // AI 해석 호출
    const context = selectedTarotType === 'love' ? partnerInfo : (selectedTarotType === 'career' ? careerInfo : todayInfo);
    let aiResult = null;
    
    try {
        aiResult = await fetchAIInterpretation(drawnCardsData, userInfo, selectedTarotType, context);
    } catch (e) {
        console.error("AI 호출 중 에러 발생:", e);
    }
    
    if (aiResult && aiResult.isQuotaExceeded) {
        interpretationContent.innerHTML = `
            <div class="bg-rose-900/50 p-6 rounded-xl border border-rose-500/50 text-rose-100 text-center fade-in">
                <i data-lucide="alert-triangle" class="w-12 h-12 mx-auto mb-4 text-rose-400"></i>
                <p class="font-bold text-lg mb-2">${currentLang === 'ko' ? '현재 무료 서비스 이용량이 많습니다.' : 'Free tier quota exceeded.'}</p>
                <p class="text-sm opacity-80">${currentLang === 'ko' ? '잠시 후 다시 시도하시거나, 나중에 확인해주세요.' : 'Please try again in a few minutes.'}</p>
            </div>
        `;
        lucide.createIcons({ root: interpretationContent });
        return;
    }

    lastAIResult = aiResult;
    interpretationContent.innerHTML = '';

    if (aiResult && aiResult.mainInterpretation && aiResult.mainInterpretation.trim().length > 0) {
        // AI 해석이 정상적으로 존재할 때
        interpretationContent.innerHTML = `<div class="bg-slate-800/50 p-6 md:p-10 rounded-xl border border-purple-500/20 fade-in whitespace-pre-line text-lg text-slate-200 leading-relaxed">${aiResult.mainInterpretation.replace(/\\n/g, '<br/>')}</div>`;
    } else {
        // AI 해석이 없거나 실패했을 때 (Fallback: 로컬 엔진 작동)
        const titlesKO = maxDrawCount === 3 ? ["✦ 시작의 기운", "✦ 전개되는 흐름", "✦ 하늘의 계시"] : ["현재의 좌표", "당면한 과제", "지나온 궤적", "다가올 풍경", "운명의 조언"];
        const titlesEN = maxDrawCount === 3 ? ["✦ Origin", "✦ Flow", "✦ Revelation"] : ["Present", "Challenge", "Past", "Future", "Advice"];
        const titles = currentLang === 'en' ? titlesEN : titlesKO;
        
        const fallbackContainer = document.createElement('div');
        fallbackContainer.className = 'space-y-4 fade-in';
        
        drawnCardsData.forEach((card, index) => {
            const textEl = document.createElement('div');
            textEl.className = `bg-slate-800/50 p-6 rounded-xl border border-purple-500/20 shadow-inner`;
            textEl.innerHTML = `<h4 class="text-amber-300 font-bold mb-3 text-xl">${titles[index]}</h4><p class="text-slate-300 leading-loose">${generateDeepInterpretation(card, index, userInfo, selectedTarotType, context)}</p>`;
            fallbackContainer.appendChild(textEl);
        });
        interpretationContent.appendChild(fallbackContainer);
        
        // 안내 메시지 살짝 표시
        showMessage(currentLang === 'ko' ? "AI 해석 연결이 원활하지 않아 로컬 엔진으로 대체합니다." : "Using local engine due to AI connection issues.", "info");
    }
}

function goToSelection() { 
    lastAIResult = null;
    showScreen('selection-screen'); 
}

function handleLogout() {
    userInfo = { name: '', birthDate: '', calendarType: 'solar', gender: 'none', maritalStatus: 'single' };
    partnerInfo = { name: '', birthDate: '', calendarType: 'solar', gender: 'none', question: '' };
    lastAIResult = null;
    localStorage.removeItem('mungTarotUser');
    localStorage.removeItem('mungTarotPartner');
    showScreen('profile-screen');
    showMessage(currentLang === 'ko' ? "로그아웃되었습니다." : "Logged out.", "info");
}

function goBack() {
    if (userInfo && userInfo.name) showScreen('selection-screen');
    else showScreen('profile-screen');
}
</script></body></html>
